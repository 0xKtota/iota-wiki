<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="IOTA Wiki Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="IOTA Wiki Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="IOTA Wiki" href="/opensearch.xml">
<link rel="preconnect" href="${matomoUrl}">
<script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var a="https://matomo.antonionardella.it/";_paq.push(["setTrackerUrl",a+"matomo.php"]),_paq.push(["setSiteId","6"]);var e=document,t=e.createElement("script"),p=e.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=a+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Material+Icons">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">Fair Roulette | IOTA Wiki</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://wiki.iota.org/wasp/guide/example_projects/fair_roulette"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-wasp-current"><meta data-react-helmet="true" property="og:title" content="Fair Roulette | IOTA Wiki"><meta data-react-helmet="true" name="description" content="An example game project with frontend and contract"><meta data-react-helmet="true" property="og:description" content="An example game project with frontend and contract"><meta data-react-helmet="true" name="keywords" content="ISCP,Smart Contracts,Rust,JavaScript,TypeScript,WASM"><meta data-react-helmet="true" property="og:image" content="https://wiki.iota.org/img/logo/WASP_logo_dark.png"><meta data-react-helmet="true" name="twitter:image" content="https://wiki.iota.org/img/logo/WASP_logo_dark.png"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://wiki.iota.org/wasp/guide/example_projects/fair_roulette"><link data-react-helmet="true" rel="alternate" href="https://wiki.iota.org/wasp/guide/example_projects/fair_roulette" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://wiki.iota.org/wasp/guide/example_projects/fair_roulette" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.a218f63b.css">
<link rel="preload" href="/assets/js/runtime~main.d535e989.js" as="script">
<link rel="preload" href="/assets/js/main.3b688fa1.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#ff0000;color:#fff" role="banner"><div class="announcementBarContent_3EUC">The work on this Wiki is still in progress. Consider contributing by using the in page editor or creating a <a href="https://github.com/iota-community/iota-wiki">PR directly</a></div></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo_dark.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link" href="/docs/learn/about-iota/an-introduction-to-iota"><div class="link"><div class="link__body"><div class="link__label">Learn</div></div></div></a><a class="navbar__item navbar__link" href="/docs/participate/support-the-network/about-nodes"><div class="link"><div class="link__body"><div class="link__label">Participate</div></div></div></a><div class="dropdown dropdown--hoverable dropdown--mega"><a href="#" class="navbar__item navbar__link"><div class="link"><div class="link__body"><div class="link__label">Build</div></div></div></a><div class="dropdown__container"><div class="dropdown__menu"><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Getting Started</div></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Chrysalis (IOTA 1.5)</div></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Libraries</div></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Smart Contracts</div></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/docs/build/getting-started/architecture"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Getting Started</div><div class="link__sublabel">IOTA development basics</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/chrysalis-docs/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Chrysalis Docs</div><div class="link__sublabel">Mainnet documentation</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/iota.rs/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Core</div><div class="link__sublabel">IOTA core functionality</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a aria-current="page" class="dropdown__link dropdown__link--active" href="/wasp/overview"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Wasp Node</div><div class="link__sublabel">Smart contract node</div></div></div></a></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/bee/getting_started/getting_started"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Bee Node</div><div class="link__sublabel">IOTA node written in Rust</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/wallet.rs/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Wallet</div><div class="link__sublabel">Build IOTA wallets</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Coordicide (IOTA 2.0)</div></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/hornet/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Hornet Node</div><div class="link__sublabel">IOTA node written in Go</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/stronghold.rs/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Stronghold</div><div class="link__sublabel">Handle secrets securely</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/IOTA-2.0-Research-Specifications/Preface"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Coordicide Specs</div><div class="link__sublabel">Decentralizing IOTA</div></div></div></a></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/identity.rs/introduction"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Identity</div><div class="link__sublabel">Identity framework</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/goshimmer/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">GoShimmer Node</div><div class="link__sublabel">IOTA 2.0 node</div></div></div></a></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/streams/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Streams</div><div class="link__sublabel">Share data securely</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"></div></div></div></div></div></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog"><div class="link"><div class="link__body"><div class="link__label">Blog</div></div></div></a><a class="navbar__item navbar__link" href="/team"><div class="link"><div class="link__body"><div class="link__label">Team</div></div></div></a><div class="toggle toggle_3Zt9 toggle--checked toggle--disabled" role="button" tabindex="-1"><div class="toggle__icon toggle__icon--unchecked" style="font-family:Material Icons">dark_mode</div><div class="toggle__icon toggle__icon--checked" style="font-family:Material Icons">light_mode</div><input type="checkbox" checked="" class="toggle__screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a tabindex="-1" class="sidebarLogo_3h0W" href="/"><img src="/img/logo.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo_dark.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--dark_hz6m"></a><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/wasp/overview">Overview</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Core Concepts</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ISCP Chains and Nodes</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Rust/WASM</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">EVM</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Example projects</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/wasp/guide/example_projects/fair_roulette">Fair Roulette</a></li></ul></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/wasp/contribute">Contribute</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Fair Roulette</h1></header><p>The fair roulette is an example reference implementation demonstrating the development, setup and interaction with a smart contract.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>For this example, we have created a very simple betting game in which players can bet on a number of a certain range. </p><p>The goal of the game is to bet on the right number, to win a share of the placed funds. This is being done in rounds. </p><p>A round is running for a certain amount of time. In our example: 60 seconds. In this timeframe, incoming bets will be added to a list of bets. After 60 seconds have passed, a winning number gets randomly generated and all players who made the right guess will receive a share of the pot.</p><p>If no round is active when a bet gets placed, the round gets initiated immediately.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="mandatory-setup"></a>Mandatory setup<a class="hash-link" href="#mandatory-setup" title="Direct link to heading">#</a></h2><p>The mandatory setup consists out of:</p><ul><li>1 GoShimmer node &gt;= 0.7.5v</li><li>1 Beta Wasp node</li><li>1 static file server for the frontend</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="technicallity"></a>Technicallity<a class="hash-link" href="#technicallity" title="Direct link to heading">#</a></h2><p>Before we dive into the contents of the project, lets get an overview of what is actually required for this game.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="fundamentals"></a>Fundamentals<a class="hash-link" href="#fundamentals" title="Direct link to heading">#</a></h3><p>Wasp is part of the IOTA ecosystem which enables the execution of smart contracts. These contracts run logic and are allowed to do state (change) requests towards the Tangle. To be able to store state, a respective GoShimmer node is required. It receives state change requests and if valid - saves them onto the Tangle. </p><p>There are two ways to interact with smart contracts.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="on-ledger-requests"></a>On Ledger requests<a class="hash-link" href="#on-ledger-requests" title="Direct link to heading">#</a></h4><p>OnLedger requests are sent to GoShimmer nodes. Wasp periodically asks GoShimmer nodes for new OnLedger requests and handles them accordingly. These messages are validated through the network and take some time to be processed. </p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="off-ledger-requests"></a>Off Ledger requests<a class="hash-link" href="#off-ledger-requests" title="Direct link to heading">#</a></h4><p>OffLedger requests are directly sent to Wasp nodes and do not require validation through GoShimmer nodes. They are therefore faster. However, they require an initial deposit of funds to a chain account as this account will initiate required OnLedger requests on the behalf of the desired contract or player.</p><blockquote><p>In our example we use OnLedger requests to initiate a betting request, a method to invoke OffLedger requests is implemented inside the frontend to make use of.</p></blockquote><p>[.. cleverly link some docs we hopefully have about this stuff :D]</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="funds"></a>Funds<a class="hash-link" href="#funds" title="Direct link to heading">#</a></h4><p>As these requests do cost some fees and to be able to actually bet with real token, the player requires a source of funds.  </p><p>Considering that the game runs on a testnet, funds can be requested from GoShimmer faucets inside the network[link faucet request]. </p><p>After aquiring some funds, they reside inside an address which is handled by a wallet.</p><p>For this PoC, we have implemented our own very narrowed down wallet that runs inside the browser itself, mostly hidden from the player. </p><p>In the future, we want to provide a solution that enables the use of Firefly or MetaMask(status?) as a secure external wallet.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="conclusion"></a>Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">#</a></h4><p>To interact with a smart contract, we require a Wasp node which hosts the contract, a GoShimmer node to interact with the tangle, funds from a GoShimmer faucet, and a client that invokes the contract by either an On or Off Ledger request. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="implementation"></a>Implementation<a class="hash-link" href="#implementation" title="Direct link to heading">#</a></h3><p>The PoC consists out of two projects residing in <code>contracts/rust/fairroulette</code>.</p><p>One is the smart contract itself. Its boilerplate was generated using the new Schema tool[link] which is shipped with this beta release.
The contract logic is written in Rust but the same implementation can be archived interchangebly with Golang.</p><p>The second project is an interactive frontend written in TypeScript, made reactive with the light Svelte framework.
This frontend sends OnLedger requests to place bets towrds the fair roulette smart contract and makes use of the GoShimmer faucet to request funds.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="the-smart-contract"></a>The smart contract<a class="hash-link" href="#the-smart-contract" title="Direct link to heading">#</a></h3><blockquote><p><a href="https://iscp.docs.iota.org/docs/tutorial/05/" target="_blank" rel="noopener noreferrer">https://iscp.docs.iota.org/docs/tutorial/05/</a></p></blockquote><p>As the smart contract is the only actor that is allowed to modify state in the context of the game, it got delegated a few tasks such as:</p><ul><li>Validating and accepting placed bets</li><li>Starting and ending a betting round</li><li>Generation of a <strong>random</strong> winning number </li><li>Sending payouts to the winners</li><li>Emitting status updates through the event system</li></ul><p>Any incoming bet will be validated. This includes the amount of token which have been bet and also the number on which the player bet on.
A number over 8 or under 1 will be rejected.</p><p>If the bet is valid and no round is active, the round state will be changed to <code>1</code> marking an active round.
The bet will be the first of a list of bets. </p><p>A delayed function call will be activated which executes <strong>after 60 seconds</strong>. </p><p>This function is the payout function which generates a random winning number and pays out the winners of the round.
The round state will be set to <code>0</code> indicating the end of the round.   </p><p>If the round is already active, the bet will be appended to the list of bets and await processing. </p><p>State changes such as the <code>round started</code> or <code>round ended</code> but also placed bets and the payout of the winners are published as events.
Events are published as messages through a public websocket.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="dependencies"></a>Dependencies<a class="hash-link" href="#dependencies" title="Direct link to heading">#</a></h4><ul><li><a href="https://rustwasm.github.io/docs/wasm-pack/quickstart.html" target="_blank" rel="noopener noreferrer">wasm-pack</a></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="building"></a>Building<a class="hash-link" href="#building" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd contracts/rust/fairroulette</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">wasm-pack build </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="the-frontend"></a>The frontend<a class="hash-link" href="#the-frontend" title="Direct link to heading">#</a></h3><p>The frontend has two main tasks. </p><p>One is to visualize the contracts state. This includes a list of all placed bets, if a round is currently active and how long its still going. Any payouts will be shown as well, including a fancy animation in case the player itself has won. </p><p>Furthermore the player can see his current available funds, his seed and his current address.</p><div class="admonition admonition-danger alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</h5></div><div class="admonition-content"><p>As always, the seed is the key to your funds. As this is a PoC we display the seed for demonstrational purposes.
<strong>Never</strong> share your seed with anyone under any circurmstance. </p></div></div><p>The second task is to enable the player to request funds and to participate in the game by placing bets. This is being done by showing the player a list of eight numbers, a selection of the amount of funds to bet, and a placing bet button. </p><p>As faucet requests require minimal proof of work, the calculation happens inside a webworker to prevent a freezing of the browser ui.</p><p>To provide the frontend with the required events, it subscribes to the public websocket of Wasp to receive changes of state. </p><p>Such events look like this:</p><p><code>vmmsg kUUCRkhjD4EGAxv3kM77ay3KMbo51UhaEoCr14TeVHc5 df79d138: fairroulette.bet.placed 12sYqEZ5GM1BnqkZ88yJgPH3CdD9wKqfgGKY1j8FYDSZb3ao5wu 531819 2</code> </p><p>This event displays a placed bet from the address <code>12sYqEZ5GM1BnqkZ88yJgPH3CdD9wKqfgGKY1j8FYDSZb3ao5wu</code>. This address bet <code>531819i</code> on the number <code>2</code>. This event originated from the smart contract id <code>df79d138</code>.</p><p>However, there is a bit more to the idea than to just subscribe to a websocket and &quot;do requests&quot;.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="the-communication-layer"></a>The communication layer<a class="hash-link" href="#the-communication-layer" title="Direct link to heading">#</a></h3><p>On and Off Ledger requests have a predefined structure. They need to get encoded in strict way and include a list of transactions provided by GoShimmer. Furthermore, they need to get signed by the client using the private key originating from a seed.  </p><p>Wasp is using the <a href="https://goshimmer.docs.iota.org/docs/protocol_specification/components/advanced_outputs" target="_blank" rel="noopener noreferrer">ExtendedLockedOutput</a> message type, which enables certain additional properties such as: </p><ul><li>fallback address and fallback timeout</li><li>unlockable by AliasUnlockBlock (if address is of AliasAddress type)</li><li>introducing a timelock (execution after deadline)</li><li>data payload for arbitrary metadata (size limits apply)</li></ul><p>This data payload is required to act on smart contracts as it contains: </p><ul><li>the smart contract id to be selected</li><li>the function id to be executed</li><li>a list of arguments to be injected into the function </li></ul><p>As we don&#x27;t expect developers of contracts and frontends to write their own implementation, we have separated the communication layer into two parts:</p><ul><li>The fairroulette_service</li><li>The wasp_client</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="the-wasp-client"></a>The wasp client<a class="hash-link" href="#the-wasp-client" title="Direct link to heading">#</a></h4><p>The wasp client is an example implementation of the communication protocol.</p><p>It provides:</p><ul><li>a basic wallet functionality</li><li>hashing algorithms</li><li>a webworker to provide proof of work </li><li>construction of On/Off Ledger requests</li><li>construction of smart contract arguments and payload</li><li>generation of seeds including their private keys and addresses</li><li>serialization of data into binary messages</li><li>deserialization of smart contract state</li></ul><p>This wasp_client can be seen as a soon to be external library. For now this is a PoC client library shipped with the project. In the future however, we want to provide a library you can simply include into your project.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="the-fairroulette-service"></a>The fairroulette service<a class="hash-link" href="#the-fairroulette-service" title="Direct link to heading">#</a></h4><p>This service is meant to be a high level implementation of the actual app. In other words: It&#x27;s the service that app or frontend developers would concentrate on. </p><p>It does not construct message types, nor does it interact with GoShimmer directly. Besides of subscribing to the websocket event system of Wasp, it does not interact directly with Wasp either. Any such communication is handled by the <code>wasp_client</code>.</p><p>The fairroulette service is a mere wrapper around smart contract invocation calls. It accesses smart contract state through the <code>wasp_client</code> and does minimal decoding of data. </p><p>Lets take a look into three parts of this service to make this more clear.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithHideOnScrollNavbar_3R7-" id="placebetonledger"></a>placeBetOnLedger<a class="hash-link" href="#placebetonledger" title="Direct link to heading">#</a></h5><p>The <a href="https://github.com/boxfish-studio/wasp/blob/feat/roulette_poc_ui/contracts/rust/fairroulette/frontend/src/lib/fairroulette_client/fair_roulette_service.ts#L144" target="_blank" rel="noopener noreferrer">placeBetOnLedger</a> function is responsible to send an On Ledger bet requests. It constructs a simple IOnLedger object  containing:</p><ul><li>the smart contract id: <code>fairroulette</code> </li><li>the function to invoke: <code>placeBet</code> </li><li>an argument: <code>-number</code> <ul><li>this is the number the player would bet on =&gt; the winning number  </li></ul></li></ul><p>Furthermore, this transaction requires an address to send the request to and also a variable amount of funds over <code>0i</code>.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>For Wasp, the <code>chainId</code> is the address to use.  </p></div></div><blockquote><p>Go into detail about the rest in a separate layer and hope we have documentation about some parts of this already.
<a href="https://iscp.docs.iota.org/docs/misc/coretypes/" target="_blank" rel="noopener noreferrer">https://iscp.docs.iota.org/docs/misc/coretypes/</a>, <a href="https://iscp.docs.iota.org/docs/misc/invoking/" target="_blank" rel="noopener noreferrer">https://iscp.docs.iota.org/docs/misc/invoking/</a></p></blockquote><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="dependencies-1"></a>Dependencies<a class="hash-link" href="#dependencies-1" title="Direct link to heading">#</a></h4><ul><li>NodeJS &gt;= 14</li><li>NPM</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="configuration"></a>Configuration<a class="hash-link" href="#configuration" title="Direct link to heading">#</a></h4><p>The frontend requires a config file to be created. The template can be copied from <code>contracts/rust/fairroulette/frontend/config.dev.sample.js</code> and renamed to <code>config.dev.js</code> inside the same folder.</p><p>Make sure to update the config values accordingly to your personal setup.
The <code>chainId</code> is the chainId which gets defined after deploying a chain (link #Deployment). </p><p><code>waspWebSocketUrl</code>, <code>waspApiUrl</code>, <code>goShimmerApiUrl</code>: Are dependent on the location of your Wasp and GoShimmer node. Make sure to keep the path of the <code>waspWebSocketUrl</code> (<code>/chain/%chainId/ws</code>)  at the end. </p><p><code>seed</code> can be either <code>undefined</code> or a predefined 44 length seed. If <code>seed</code> is set to <code>undefined</code> a new seed will be generated as soon a user opens the page. A predefined seed will be set for all users. This can be useful for development purposes. </p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="building-1"></a>Building<a class="hash-link" href="#building-1" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd contracts/rust/fairroulette/frontend</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">npm install</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">npm run build_worker</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">npm run dev</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>npm run dev</code> will run a development server that exposes the transpiled frontend on <code>http://localhost:5000</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="deployment"></a>Deployment<a class="hash-link" href="#deployment" title="Direct link to heading">#</a></h2><blockquote><p><a href="https://iscp.docs.iota.org/docs/misc/deploy/" target="_blank" rel="noopener noreferrer">https://iscp.docs.iota.org/docs/misc/deploy/</a></p></blockquote><p>If the smart contract was built successfully, let&#x27;s try to deploy the binary of the contract.</p><p>As deployments cost some fees, funds are required.</p><p>To validate the amount of funds run</p><p><code>./wasp-cli balance</code></p><p>If the output looks like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Address index 0</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Address: 17kfxps7zrxSi17sMGVwQt7NQwmdNYXjQXxkME2azX5Wb</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Balance:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    IOTA: 4525518</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ------</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Total: 4525518</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>It&#x27;s possible to head directly to the deposit and deployment, otherwise request funds from the faucet first. <code>./wasp-cli request-funds</code>. </p><hr><p>Before we are able to deploy the contract, it&#x27;s required to deploy a chain. </p><p>In our example we deploy a chain to a single Wasp node, which equates into a committee of <code>0</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">./wasp-cli chain deploy --committee=0 --quorum=1 --chain=roulette_chain --description=&quot;The fair roulette chain&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If this command was successful, we can deploy the contract binary afterwords. This deployment requires funds to be deposited to the <strong>chain</strong>. This is archived by running: </p><p><code>./wasp-cli chain deposit IOTA:10000</code></p><p>Now it&#x27;s possible to deploy the binary contract by executing:</p><p><code>./wasp-cli chain deploy-contract wasmtime fairroulette &quot;fairroulette&quot;  contracts/rust/fairroulette/pkg/fairroulette_bg.wasm</code></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/wasp/guide/evm/tooling"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« EVM Tooling</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/wasp/contribute"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Contributing »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#mandatory-setup" class="table-of-contents__link">Mandatory setup</a></li><li><a href="#technicallity" class="table-of-contents__link">Technicallity</a><ul><li><a href="#fundamentals" class="table-of-contents__link">Fundamentals</a></li><li><a href="#implementation" class="table-of-contents__link">Implementation</a></li><li><a href="#the-smart-contract" class="table-of-contents__link">The smart contract</a></li><li><a href="#the-frontend" class="table-of-contents__link">The frontend</a></li><li><a href="#the-communication-layer" class="table-of-contents__link">The communication layer</a></li></ul></li><li><a href="#deployment" class="table-of-contents__link">Deployment</a></li></ul></div></div></div></div></main></div></div><footer class="footer padding--none"><div class="container"><div class="row footer__links padding-vert--xl"><div class="col footer__col"><h4 class="footer__title">LEARN</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/learn/about-iota/an-introduction-to-iota">About IOTA</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/iota-token/buying-iota">IOTA Token</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/wallets/what-is-a-wallet">Wallets</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/networks/iota-1.5-chrysalis">Networks</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/resource-materials/glossary">Resource Materials</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/research/research-outline">Research</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">PARTICIPATE</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/participate/support-the-network/about-nodes">Support the network</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/the-community/discord">The Community</a></li><li class="footer__item"><a href="https://www.iota.org/solutions/partnerships" target="_blank" rel="noopener noreferrer" class="footer__link-item">Partnerships</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/funding/edf-funding">Funding</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/use-cases/industry-applications">Use Cases</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/frameworks/introduction">Frameworks</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">BUILD</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/build/getting-started/architecture">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/build/fundamentals/cryptography">Fundamentals</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/build/exchange-integration/exchange-integration-guide">Exchange Integration</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/build/tutorials/youtube">Tutorials</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">WIKI</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/team">Team</a></li><li class="footer__item"><a href="https://github.com/iota-community/iota-wiki" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://github.com/jlvandenhout/docusaurus-plugin-docs-editor" target="_blank" rel="noopener noreferrer" class="footer__link-item">Editor Github</a></li><li class="footer__item"><a href="https://docusaurus.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus</a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/contribute-to-wiki/welcome">Contribute</a></li></ul></div></div><div class="footer__bottom padding-bottom--xl"><div><a href="https://www.iota.org" target="_blank" rel="noopener noreferrer"><img src="/img/iota_logo.svg" alt="IOTA Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/iota_logo.svg" alt="IOTA Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">© 2021 IOTA Wiki. Built with Docusaurus.</div></div></div><div class="social"><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:var(--ifm-color-gray-900)" href="https://www.youtube.com/c/iotafoundation"><div class="social__font social__icon"></div><div class="social__title">Youtube</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#2C3850" href="https://www.github.com/iotaledger/"><div class="social__font social__icon"></div><div class="social__title">GitHub</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#4B576F" href="https://discord.iota.org/"><div class="social__font social__icon"></div><div class="social__title">Discord</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#6A768E" href="https://www.twitter.com/iota/"><div class="social__font social__icon"></div><div class="social__title">Twitter</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#7D89A1" href="https://www.reddit.com/r/iota/"><div class="social__font social__icon"></div><div class="social__title">Reddit</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#8995AD" href="https://www.linkedin.com/company/iotafoundation/"><div class="social__font social__icon"></div><div class="social__title">Linkedin</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#99A5BD" href="https://www.instagram.com/iotafoundation/"><div class="social__font social__icon"></div><div class="social__title">Instagram</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#BAC6DE" href="https://www.facebook.com/TheIOTAFoundation/"><div class="social__font social__icon"></div><div class="social__title">Facebook</div></a></div></footer></div>
<script src="/assets/js/runtime~main.d535e989.js"></script>
<script src="/assets/js/main.3b688fa1.js"></script>
</body>
</html>