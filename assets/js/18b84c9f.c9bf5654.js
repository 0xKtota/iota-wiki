"use strict";(self.webpackChunkiota_wiki=self.webpackChunkiota_wiki||[]).push([[24962],{48091:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return u}});var a=n(87462),i=n(63366),r=(n(67294),n(3905)),o=["components"],s={image:"/img/integration-services/logo/integration_services.png",description:"This section will show you an example on how to authenticate using Java.",keywords:["how to","authentication","jwt","nonce","not-authenticated",401,"java"]},l="Java",c={unversionedId:"basics/authentication/example_java",id:"basics/authentication/example_java",title:"Java",description:"This section will show you an example on how to authenticate using Java.",source:"@site/content/build/integration-services/production/documentation/docs/basics/authentication/example_java.md",sourceDirName:"basics/authentication",slug:"/basics/authentication/example_java",permalink:"/integration-services/basics/authentication/example_java",draft:!1,editUrl:"https://github.com/iotaledger/integration-services/edit/develop/documentation/content/build/integration-services/production/documentation/docs/basics/authentication/example_java.md",tags:[],version:"current",frontMatter:{image:"/img/integration-services/logo/integration_services.png",description:"This section will show you an example on how to authenticate using Java.",keywords:["how to","authentication","jwt","nonce","not-authenticated","401","java"]},sidebar:"docs",previous:{title:"Integration Services SDK",permalink:"/integration-services/basics/authentication/example_is_sdk"},next:{title:"IOTA Identity",permalink:"/integration-services/basics/identity"}},p={},u=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Required Packages",id:"required-packages",level:3},{value:"Authentication Workflow",id:"authentication-workflow",level:2},{value:"1. Request a Nonce",id:"1-request-a-nonce",level:3},{value:"2. Hash the Nonce",id:"2-hash-the-nonce",level:3},{value:"3. Sign the Hashed Nonce",id:"3-sign-the-hashed-nonce",level:3},{value:"4. Request the JWT",id:"4-request-the-jwt",level:3},{value:"5. Set the JWT as Request Header",id:"5-set-the-jwt-as-request-header",level:3},{value:"Putting It All Together",id:"putting-it-all-together",level:2}],d={toc:u};function h(e){var t=e.components,n=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"java"},"Java"),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"The ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/albydeca/iota-is-sdk"},"Integration Services Java library")," is still in BETA. Please note that not everything may yet run smoothly.")),(0,r.kt)("p",null,"In this example, you will learn to authenticate your identity using Java. Make sure to read the ",(0,r.kt)("a",{parentName:"p",href:"https://wiki.iota.org/integration-services/authentication"},"general authentication concept")," so you can fully understand the ",(0,r.kt)("a",{parentName:"p",href:"https://wiki.iota.org/integration-services/authentication#authentication-workflow"},"Authentication Workflow"),"."),(0,r.kt)("p",null,"This example uses the following identity: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"{\n    identityId: 'did:iota:8BAmUqAg4aUjV3T9WUhPpDnFVbJSk16oLyFq3m3e62MF',\n    secretKey: '5N3SxG4UzVDpNe4LyDoZyb6bSgE9tk3pE2XP5znXo5bF'\n}\n")),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://openjdk.java.net/projects/jdk/16/"},"JDK 16")," (recommended)"),(0,r.kt)("li",{parentName:"ul"},"A reference to an instance of the ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/iotaledger/integration-services"},"Integration Services API")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://maven.apache.org/"},"Maven"))),(0,r.kt)("h3",{id:"required-packages"},"Required Packages"),(0,r.kt)("p",null,"Ideally every dependency listed in the project's ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/albydeca/iota-is-sdk/blob/main/pom.xml"},"POM")," (",(0,r.kt)("inlineCode",{parentName:"p"},"mvn clean install"),"). This example uses in particular:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"org.apache.commons.codec.digest")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"org.apache.http.*")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"org.bitcoinj.core.Base58")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"org.bouncycastle.crypto")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"org.json.*"))),(0,r.kt)("h2",{id:"authentication-workflow"},"Authentication Workflow"),(0,r.kt)("h3",{id:"1-request-a-nonce"},"1. Request a Nonce"),(0,r.kt)("p",null,"First, request a nonce and supply your id."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"You can find your current API version using the ",(0,r.kt)("a",{parentName:"p",href:"http://localhost:3000/info"},"http://localhost:3000/info")," endpoint. This example uses ",(0,r.kt)("inlineCode",{parentName:"p"},"v0.1"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'private String createNonce(String didId)\n            throws IOException, URISyntaxException, ParseException, InvalidAPIResponseException {\n        final String endpoint = "authentication/prove-ownership/" + didId;\n\n        JSONObject response = sendIOTAGetRequest(endpoint, null, false);\n        return response.getString("nonce");\n    }\n\npublic JSONObject sendIOTAGetRequest(String endpoint, Map<String, String> params, boolean withAuth)\n            throws ClientProtocolException, IOException, URISyntaxException, ParseException,\n            InvalidAPIResponseException {\n        CloseableHttpClient client = HttpClients.createDefault();\n        final HttpEntity response_body = sendGetRequest(endpoint, params, withAuth, null, client); // see last step of tutorial for implementation of this method\n        if (response_body == null) {\n            return null;\n        }\n\n        JSONObject result = new JSONObject(EntityUtils.toString(response_body, StandardCharsets.UTF_8));\n        client.close();\n        return result;\n    }\n')),(0,r.kt)("p",null,"The returned response body  will look like this .js object."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"{ nonce: '3eaf8814caa842d94fdb96fc26d02f7c339e65ff' }\n")),(0,r.kt)("h3",{id:"2-hash-the-nonce"},"2. Hash the Nonce"),(0,r.kt)("p",null,"After you have retrieved the nonce, you should hash it. You can use insert java method to hash the nonce with the SHA-256 hash function and convert it to hexadecimal."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public void hashAndSignNonce(String privateKey, String publicKey, String nonce, String didId)\n            throws IOException, CryptoException, URISyntaxException, InvalidAPIResponseException {\n\n        byte[] b58key = Base58.decode(privateKey); // Decode a base58 key and encode it as hex key\n        String b58keyHex = DatatypeConverter.printHexBinary(b58key).toLowerCase();\n        byte[] convertKey = DatatypeConverter.parseHexBinary(b58keyHex);\n\n        String hashNonceHex = DigestUtils.sha256Hex(nonce); // Hash a nonce with SHA-256 (apache_commons)\n        byte[] convertNonce = DatatypeConverter.parseHexBinary(hashNonceHex);\n        [...]\n")),(0,r.kt)("p",null,"The example's nonce will generate the following hash:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"6d748f209e5af1f5b8825f7822d6659c45c874076cd2b3337c7861fd94cd3ba5\n")),(0,r.kt)("h3",{id:"3-sign-the-hashed-nonce"},"3. Sign the Hashed Nonce"),(0,r.kt)("p",null,"Your secret key is encoded in Base58 and has to be decoded. Once it has been decoded, the nonce is signed with your encoded secret key and saved as a hexadecimal string."),(0,r.kt)("admonition",{type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"Never save your secret key in plain text in your code. Use local environment variables or IOTA ",(0,r.kt)("a",{parentName:"p",href:"https://wiki.iota.org/stronghold.rs/welcome"},"Stronghold")," to store your secret keys securely.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"        [...]\n\n        Ed25519PrivateKeyParameters privateKeyParams = new Ed25519PrivateKeyParameters(convertKey, 0); // Encode in\n                                                                                                        // PrivateKey\n        Signer signer = new Ed25519Signer(); // Sign a nonce using the private key\n        signer.init(true, privateKeyParams);\n        signer.update(convertNonce, 0, convertNonce.length);\n        byte[] signature = signer.generateSignature();\n\n        String sign = DatatypeConverter.printHexBinary(signature).toLowerCase();\n        [...]\n")),(0,r.kt)("p",null,"The example's nonce and secret key will generate the following signed nonce:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"270c2e502c5c753e39159683981e452444f81a10d798f56406a9c471d672a5ede1792cb7f97d4f9c9efeec7bf35577dd1f8482afca7e3710291868a65bf91e07\n")),(0,r.kt)("h3",{id:"4-request-the-jwt"},"4. Request the JWT"),(0,r.kt)("p",null,"The last step is to request the JWT. You can use the following code snippet with your signed nonce in the request body."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'    [...]\n        final String endpoint = "authentication/prove-ownership/" + didId;\n\n        JSONObject json = new JSONObject().put("signedNonce", sign);\n\n        JSONObject response = sendIOTAPostRequest(endpoint, json, false);\n        byte[] b58keyPrimary = Base58.decode(publicKey);\n        String b58keyPrimaryHex = DatatypeConverter.printHexBinary(b58keyPrimary).toLowerCase();\n        byte[] convert_primarykey = DatatypeConverter.parseHexBinary(b58keyPrimaryHex);\n\n        Ed25519PublicKeyParameters primaryKeyVerify = new Ed25519PublicKeyParameters(convert_primarykey, 0);\n        Signer verifier = new Ed25519Signer();\n        verifier.init(false, primaryKeyVerify);\n        verifier.update(convertNonce, 0, convertNonce.length);\n        boolean verified = verifier.verifySignature(signature);\n\n        System.out.println("Verify Signature: " + verified);\n        this.jwt = response.getString("jwt");\n\n    }\n')),(0,r.kt)("p",null,"The returned JS object will contain the following JWT:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"{\n  jwt: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoiZGlkOmlvdGE6OEJBbVVxQWc0YVVqVjNUOVdVaFBwRG5GVmJKU2sxNm9MeUZxM20zZTYyTUYiLCJwdWJsaWNLZXkiOiI3WFRYVlJ5M0cxTVhjbURrejJiUUNiV3B2OEF6b1FSZ3hHdjVtRG0xRkoxdCIsInVzZXJuYW1lIjoiVGltMTIzNDUiLCJyZWdpc3RyYXRpb25EYXRlIjoiMjAyMi0wMi0xOFQwNzo0ODo0NSswMTowMCIsImNsYWltIjp7InR5cGUiOiJQZXJzb24ifSwicm9sZSI6IlVzZXIifSwiaWF0IjoxNjQ1MTc3OTg1LCJleHAiOjE2NDUyNjQzODV9.-O2UpPyfWOvtLV2cUF9fPVhgCGDCVwFU9zXrpn_uKU0'\n}\n")),(0,r.kt)("h3",{id:"5-set-the-jwt-as-request-header"},"5. Set the JWT as Request Header"),(0,r.kt)("p",null,"This is an example of a GET request to the API with the JWT from the last step included in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Authorization"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'private HttpEntity sendGetRequest(String endpoint, Map<String, String> params, boolean needsBearer,\n            String presharedKey, CloseableHttpClient client) throws URISyntaxException, ClientProtocolException,\n            IOException, ParseException, InvalidAPIResponseException {\n        URIBuilder builder = new URIBuilder(this.baseUrl + endpoint);\n\n        if (params != null) {\n            for (Map.Entry<String, String> e : params.entrySet()) {\n                builder.setParameter(e.getKey(), e.getValue());\n            }\n        }\n        if (presharedKey != null) {\n            builder.setParameter("preshared-key", presharedKey);\n        }\n\n        builder.setParameter("api-key", this.apiKey);\n        final URI urlFinal = builder.build();\n        System.out.println("GET " + urlFinal.toString());\n        HttpGet httpGet = new HttpGet(urlFinal);\n\n        httpGet.setHeader(HttpHeaders.ACCEPT, "application/json");\n        if (needsBearer && this.jwt != null) {\n            httpGet.setHeader(HttpHeaders.AUTHORIZATION, "Bearer " + this.jwt);\n        }\n\n        CloseableHttpResponse response = client.execute(httpGet);\n        final HttpEntity response_body = response.getEntity();\n        int statusCode = response.getStatusLine().getStatusCode();\n        if (statusCode != 200) {\n            throw new InvalidAPIResponseException(\n                    statusCode + EntityUtils.toString(response_body, StandardCharsets.UTF_8));\n        }\n        return response_body;\n    }\n\n')),(0,r.kt)("h2",{id:"putting-it-all-together"},"Putting It All Together"),(0,r.kt)("p",null,"You can find the complete code example ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/albydeca/iota-is-sdk/blob/main/src/main/java/net/gradbase/clients/BaseClient.java"},"here"),". All snippets above are taken from there."))}h.isMDXComponent=!0},3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return h}});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(n),h=i,y=d["".concat(l,".").concat(h)]||d[h]||u[h]||r;return n?a.createElement(y,o(o({ref:t},p),{},{components:n})):a.createElement(y,o({ref:t},p))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var c=2;c<r;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);