"use strict";(self.webpackChunkiota_wiki=self.webpackChunkiota_wiki||[]).push([[16117],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return u}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),l=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=l(n),u=r,h=d["".concat(c,".").concat(u)]||d[u]||m[u]||i;return n?a.createElement(h,o(o({ref:t},p),{},{components:n})):a.createElement(h,o({ref:t},p))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var l=2;l<i;l++)o[l]=n[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},33917:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return c},default:function(){return u},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return m}});var a=n(87462),r=n(63366),i=(n(67294),n(3905)),o=["components"],s={description:"Compatibility between the ISC EVM layer and existing Ethereum smart contracts and tooling.",image:"/img/logo/WASP_logo_dark.png",keywords:["smart contracts","EVM","Ethereum","Solidity","limitations","compatibility","fees","reference"]},c="EVM compatibility in IOTA Smart Contracts",l={unversionedId:"guide/evm/compatibility",id:"guide/evm/compatibility",title:"EVM compatibility in IOTA Smart Contracts",description:"Compatibility between the ISC EVM layer and existing Ethereum smart contracts and tooling.",source:"@site/content/build/wasp/develop/documentation/docs/guide/evm/compatibility.md",sourceDirName:"guide/evm",slug:"/guide/evm/compatibility",permalink:"/smart-contracts/develop/guide/evm/compatibility",draft:!1,editUrl:"https://github.com/iotaledger/wasp/edit/develop/documentation/content/build/wasp/develop/documentation/docs/guide/evm/compatibility.md",tags:[],version:"current",frontMatter:{description:"Compatibility between the ISC EVM layer and existing Ethereum smart contracts and tooling.",image:"/img/logo/WASP_logo_dark.png",keywords:["smart contracts","EVM","Ethereum","Solidity","limitations","compatibility","fees","reference"]},sidebar:"tutorialSidebar",previous:{title:"EVM/Solidity Based Smart Contracts",permalink:"/smart-contracts/develop/guide/evm/introduction"},next:{title:"How to use EVM in IOTA Smart Contracts",permalink:"/smart-contracts/develop/guide/evm/using"}},p={},m=[],d={toc:m};function u(e){var t=e.components,n=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"evm-compatibility-in-iota-smart-contracts"},"EVM compatibility in IOTA Smart Contracts"),(0,i.kt)("p",null,"EVM support in IOTA Smart Contracts is provided by the ",(0,i.kt)("inlineCode",{parentName:"p"},"evm")," core contract. Its main purpose is to store the EVM state (account balances, state, code, etc.) and to provide a way to execute EVM code in order to manipulate the state. All of this is done on top of the ISC layer, which itself provides the rest of the machinery needed to run smart contracts (signed requests, blocks, state, proofs, etc)."),(0,i.kt)("p",null,"However, The ISC EVM layer is also designed to be as compatibile as possible with existing Ethereum tools like ",(0,i.kt)("a",{parentName:"p",href:"https://metamask.io/"},"MetaMask"),', which assume that the EVM code will be run on an Ethereum blockchain, composed of Ethereum blocks containing Ethereum transactions. Unfortunately, since ISC works in a fundamentally different way, providing 100% compatibility is not possible. We do our best to somehow "fool" the Ethereum tools into thinking they are interfacing with a real Ethereum node, but some differences in behavior are inevitable.'),(0,i.kt)("p",null,"Here are some of the most important properties and limitations of EVM support in IOTA Smart Contracts:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"The Wasp node provides a JSON-RPC service, which is the standard protocol used by Ethereum tools. Upon receiving a signed Ethereum transaction via JSON-RPC, the transaction is wrapped into an ISC off-ledger request. The sender of the request is the Ethereum address that signed the original transaction (e.g. the Metamask account).")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"The EVM state is stored in raw form (in contrast with an Ethereum blockchain, which stores the state in a Merkle tree \u2014 it would be inefficient to do that since it would be duplicating work done by the ISC layer).")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Any Ethereum transactions present in an ISC block are executed by the ",(0,i.kt)("inlineCode",{parentName:"p"},"evm"),' core contract, updating the EVM state accordingly. To provide compatibility with EVM tools, a "fake" Ethereum block is also created and stored. Not being part of a real Ethereum blockchain, some attributes of the blocks will contain dummy values (e.g. ',(0,i.kt)("inlineCode",{parentName:"p"},"stateRoot"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"nonce"),", etc).")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Each stored block contains the executed Ethereum transactions and corresponding Ethereum receipts. If storage is limited, it is possible to configure EVM so that the latest N blocks are stored.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"There is no guaranteed ",(0,i.kt)("em",{parentName:"p"},"block time"),'. A new EVM "block" will be created only when an ISC block is created, and ISC does not enforce an average block time.')),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Any Ethereum address is accepted as a valid ",(0,i.kt)("inlineCode",{parentName:"p"},"AgentID"),", and thus can own L2 tokens on an IOTA Smart Contract chain, just like IOTA addresses.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"The Ethereum balance of an account is tied to its L2 ISC balance in the token used to pay for gas (e.g. by default ",(0,i.kt)("inlineCode",{parentName:"p"},"eth_getBalance")," will return the L2 base token balance of the given Ethereum account). Any attempt to directly modify an Ethereum account balance will fail (e.g. attaching value to a transaction, calling ",(0,i.kt)("inlineCode",{parentName:"p"},"<address>.transfer(...)"),", etc).")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"In order to manipulate the owned ISC tokens (and in general, to access ISC functionality), there is a special Ethereum contract called ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/iotaledger/wasp/blob/develop/packages/vm/core/evm/isccontract/ISC.sol"},(0,i.kt)("inlineCode",{parentName:"a"},"isc"))," that provides bindings to the ISC sandbox (e.g. ",(0,i.kt)("inlineCode",{parentName:"p"},"isc.send(...)")," to send tokens).")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"The used EVM gas is converted to ISC gas before being charged to the sender. The conversion ratio is configurable. The token used to pay for gas is the same token configured in the ISC chain (IOTA by default). The gas fee is debited from the sender's L2 account, and it has to be deposited beforehand."))))}u.isMDXComponent=!0}}]);