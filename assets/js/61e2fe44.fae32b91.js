"use strict";(self.webpackChunkiota_wiki=self.webpackChunkiota_wiki||[]).push([[9132],{56099:function(e,t,n){n.r(t),n.d(t,{assets:function(){return s},contentTitle:function(){return c},default:function(){return k},frontMatter:function(){return l},metadata:function(){return u},toc:function(){return d}});var a=n(87462),o=n(63366),i=(n(67294),n(3905)),r=["components"],l={description:"The `accounts` contract keeps the ledger of on-chain accounts.",image:"/img/logo/WASP_logo_dark.png",keywords:["core contracts","accounts","deposit","withdraw","assets","balance","reference"]},c="The `accounts` Contract",u={unversionedId:"guide/core_concepts/core_contracts/accounts",id:"guide/core_concepts/core_contracts/accounts",title:"The `accounts` Contract",description:"The `accounts` contract keeps the ledger of on-chain accounts.",source:"@site/content/build/wasp/develop/documentation/docs/guide/core_concepts/core_contracts/accounts.md",sourceDirName:"guide/core_concepts/core_contracts",slug:"/guide/core_concepts/core_contracts/accounts",permalink:"/smart-contracts/develop/guide/core_concepts/core_contracts/accounts",draft:!1,editUrl:"https://github.com/iotaledger/wasp/edit/develop/documentation/content/build/wasp/develop/documentation/docs/guide/core_concepts/core_contracts/accounts.md",tags:[],version:"current",frontMatter:{description:"The `accounts` contract keeps the ledger of on-chain accounts.",image:"/img/logo/WASP_logo_dark.png",keywords:["core contracts","accounts","deposit","withdraw","assets","balance","reference"]},sidebar:"tutorialSidebar",previous:{title:"The `root` Contract",permalink:"/smart-contracts/develop/guide/core_concepts/core_contracts/root"},next:{title:"The `blob` Contract",permalink:"/smart-contracts/develop/guide/core_concepts/core_contracts/blob"}},s={},d=[{value:"Entry Points",id:"entry-points",level:2},{value:"<code>deposit()</code>",id:"deposit",level:3},{value:"<code>withdraw()</code>",id:"withdraw",level:3},{value:"<code>transferAllowanceTo(a AgentID, c ForceOpenAccount)</code>",id:"transferallowancetoa-agentid-c-forceopenaccount",level:3},{value:"<code>harvest(f ForceMinimumBaseTokens)</code>",id:"harvestf-forceminimumbasetokens",level:3},{value:"<code>foundryCreateNew(t TokenScheme) s SerialNumber</code>",id:"foundrycreatenewt-tokenscheme-s-serialnumber",level:3},{value:"<code>foundryModifySupply(s SerialNumber, d SupplyDeltaAbs, y DestroyTokens)</code>",id:"foundrymodifysupplys-serialnumber-d-supplydeltaabs-y-destroytokens",level:3},{value:"<code>foundryDestroy(s SerialNumber)</code>",id:"foundrydestroys-serialnumber",level:3},{value:"Views",id:"views",level:2},{value:"<code>balance(a AgentID)</code>",id:"balancea-agentid",level:3},{value:"<code>balanceBaseToken(a AgentID)</code>",id:"balancebasetokena-agentid",level:3},{value:"<code>balanceNativeToken(a AgentID, N TokenID)</code>",id:"balancenativetokena-agentid-n-tokenid",level:3},{value:"<code>totalAssets()</code>",id:"totalassets",level:3},{value:"<code>accounts()</code>",id:"accounts",level:3},{value:"<code>getNativeTokenIDRegistry()</code>",id:"getnativetokenidregistry",level:3},{value:"<code>foundryOutput(s FoundrySerialNumber)</code>",id:"foundryoutputs-foundryserialnumber",level:3},{value:"<code>accountNFTs(a AgentID)</code>",id:"accountnftsa-agentid",level:3},{value:"<code>nftData(z NFTID)</code>",id:"nftdataz-nftid",level:3},{value:"<code>getAccountNonce(a AgentID)</code>",id:"getaccountnoncea-agentid",level:3},{value:"Schemas",id:"schemas",level:2},{value:"<code>TokenID</code>",id:"tokenid",level:3},{value:"<code>NFTData</code>",id:"nftdata",level:3}],p={toc:d};function k(e){var t=e.components,n=(0,o.Z)(e,r);return(0,i.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"the-accounts-contract"},"The ",(0,i.kt)("inlineCode",{parentName:"h1"},"accounts")," Contract"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"accounts")," contract is one of the ",(0,i.kt)("a",{parentName:"p",href:"/smart-contracts/develop/overview"},"core contracts")," on each IOTA Smart Contracts\nchain."),(0,i.kt)("p",null,"This contract keeps a consistent ledger of on-chain accounts in its state, i.e. ",(0,i.kt)("a",{parentName:"p",href:"../accounts/how-accounts-work"},"the L2 ledger"),"."),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"entry-points"},"Entry Points"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"accounts")," contract provides functions to deposit and withdraw tokens, information about the assets deposited on the chain, as well as functionality to create/utilize foundries.  "),(0,i.kt)("h3",{id:"deposit"},(0,i.kt)("inlineCode",{parentName:"h3"},"deposit()")),(0,i.kt)("p",null,"A no-op that has the side effect of crediting any transfered tokens to the sender's account."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"As with every call, the gas fee is debited from the L2 account right after\nexecuting the request.")),(0,i.kt)("h3",{id:"withdraw"},(0,i.kt)("inlineCode",{parentName:"h3"},"withdraw()")),(0,i.kt)("p",null,"Moves tokens from the caller's on-chain account to the caller's L1 address.\nThe amount of tokens to be withdrawn must be specified via the allowance of the request."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"A call to withdraw means that a L1 output will be created.\nBecause of this, the withdrawn amount must be able to cover the L1 storage deposit, otherwise it will fail.")),(0,i.kt)("h3",{id:"transferallowancetoa-agentid-c-forceopenaccount"},(0,i.kt)("inlineCode",{parentName:"h3"},"transferAllowanceTo(a AgentID, c ForceOpenAccount)")),(0,i.kt)("p",null,"Moves the specified allowance from the sender's L2 account to the given L2 account on the chain."),(0,i.kt)("p",null,"Parameters:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"a")," (",(0,i.kt)("inlineCode",{parentName:"li"},"AgentID"),"): The target L2 account"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"c")," (optional ",(0,i.kt)("inlineCode",{parentName:"li"},"bool")," - default: ",(0,i.kt)("inlineCode",{parentName:"li"},"false"),"): If the target Agent ID doesn't yet have funds on the chain, ",(0,i.kt)("inlineCode",{parentName:"li"},"c = true")," specifies that the account should be created; otherwise the call fails.")),(0,i.kt)("h3",{id:"harvestf-forceminimumbasetokens"},(0,i.kt)("inlineCode",{parentName:"h3"},"harvest(f ForceMinimumBaseTokens)")),(0,i.kt)("p",null,"Only the chain owner can call this entry point, which moves all tokens from the chain ",(0,i.kt)("a",{parentName:"p",href:"../accounts/the-common-account"},"common account")," to the sender's L2 account."),(0,i.kt)("p",null,"Parameters:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"f")," (optional ",(0,i.kt)("inlineCode",{parentName:"li"},"uint64")," - default: ",(0,i.kt)("inlineCode",{parentName:"li"},"MinimumBaseTokensOnCommonAccount"),"): specifies the amount of base tokens to leave in the common account.")),(0,i.kt)("h3",{id:"foundrycreatenewt-tokenscheme-s-serialnumber"},(0,i.kt)("inlineCode",{parentName:"h3"},"foundryCreateNew(t TokenScheme) s SerialNumber")),(0,i.kt)("p",null,"Creates a new foundry with the specified token scheme, and assigns the foundry to the sender."),(0,i.kt)("p",null,"Parameters:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"t")," (",(0,i.kt)("a",{parentName:"li",href:"https://github.com/iotaledger/iota.go/blob/develop/token_scheme.go"},(0,i.kt)("inlineCode",{parentName:"a"},"iotago::TokenScheme")),"): The token scheme for the new foundry.")),(0,i.kt)("p",null,"The storage deposit for the new foundry must be provided via allowance (only the minimum required will be used)."),(0,i.kt)("p",null,"Returns:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"s")," (",(0,i.kt)("inlineCode",{parentName:"li"},"uint32"),"): The serial number of the newly created foundry")),(0,i.kt)("h3",{id:"foundrymodifysupplys-serialnumber-d-supplydeltaabs-y-destroytokens"},(0,i.kt)("inlineCode",{parentName:"h3"},"foundryModifySupply(s SerialNumber, d SupplyDeltaAbs, y DestroyTokens)")),(0,i.kt)("p",null,"Mints or destroys tokens for the given foundry, which must be controlled by the caller."),(0,i.kt)("p",null,"Parameters:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"s")," (",(0,i.kt)("inlineCode",{parentName:"li"},"uint32"),"): The serial number of the foundry"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"d")," (positive ",(0,i.kt)("inlineCode",{parentName:"li"},"big.Int"),"): Amount to mint or destroy"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"y")," (optional ",(0,i.kt)("inlineCode",{parentName:"li"},"bool")," - default: ",(0,i.kt)("inlineCode",{parentName:"li"},"false"),") Whether to destroy tokens (",(0,i.kt)("inlineCode",{parentName:"li"},"true"),") or not (",(0,i.kt)("inlineCode",{parentName:"li"},"false"),")")),(0,i.kt)("p",null,"When minting new tokens, the storage deposit for the new output must be provided via allowance."),(0,i.kt)("p",null,"When destroying tokens, the tokens to be destroyed must be provided via allowance."),(0,i.kt)("h3",{id:"foundrydestroys-serialnumber"},(0,i.kt)("inlineCode",{parentName:"h3"},"foundryDestroy(s SerialNumber)")),(0,i.kt)("p",null,"Destroys a given foundry output on L1, reinbursing the storage deposit to the caller.\nThe foundry must be owned by the caller."),(0,i.kt)("admonition",{type:"warning"},(0,i.kt)("p",{parentName:"admonition"},"This operation cannot be reverted.")),(0,i.kt)("p",null,"Parameters:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"s")," (",(0,i.kt)("inlineCode",{parentName:"li"},"uint32"),"): The serial number of the foundry")),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"views"},"Views"),(0,i.kt)("h3",{id:"balancea-agentid"},(0,i.kt)("inlineCode",{parentName:"h3"},"balance(a AgentID)")),(0,i.kt)("p",null,"Returns the fungible tokens owned by the given Agent ID on the chain."),(0,i.kt)("p",null,"Parameters:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"a")," (",(0,i.kt)("inlineCode",{parentName:"li"},"AgentID"),"): The account Agent ID")),(0,i.kt)("p",null,"Returns:"),(0,i.kt)("p",null,"A map of ",(0,i.kt)("a",{parentName:"p",href:"#tokenid"},(0,i.kt)("inlineCode",{parentName:"a"},"TokenID"))," => ",(0,i.kt)("inlineCode",{parentName:"p"},"big.Int"),". The L1 base tokens is represented by an empty Token ID (a key with length 0)."),(0,i.kt)("h3",{id:"balancebasetokena-agentid"},(0,i.kt)("inlineCode",{parentName:"h3"},"balanceBaseToken(a AgentID)")),(0,i.kt)("p",null,"Returns amount of base tokens owned by any AgentID ",(0,i.kt)("inlineCode",{parentName:"p"},"a")," on the chain."),(0,i.kt)("p",null,"Parameters:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"a")," (",(0,i.kt)("inlineCode",{parentName:"li"},"AgentID"),"): The account Agent ID")),(0,i.kt)("p",null,"Returns:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"B")," (",(0,i.kt)("inlineCode",{parentName:"li"},"uint64"),"): The amount of base tokens in the account")),(0,i.kt)("h3",{id:"balancenativetokena-agentid-n-tokenid"},(0,i.kt)("inlineCode",{parentName:"h3"},"balanceNativeToken(a AgentID, N TokenID)")),(0,i.kt)("p",null,"Returns the amount of native tokens with Token ID ",(0,i.kt)("inlineCode",{parentName:"p"},"N")," owned by any AgentID ",(0,i.kt)("inlineCode",{parentName:"p"},"a"),"  on the chain."),(0,i.kt)("p",null,"Parameters:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"a")," (",(0,i.kt)("inlineCode",{parentName:"li"},"AgentID"),"): The account Agent ID"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"N")," (",(0,i.kt)("a",{parentName:"li",href:"#tokenid"},(0,i.kt)("inlineCode",{parentName:"a"},"TokenID")),"): The Token ID")),(0,i.kt)("p",null,"Returns:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"B")," (",(0,i.kt)("inlineCode",{parentName:"li"},"big.Int"),"): The amount of native tokens in the account")),(0,i.kt)("h3",{id:"totalassets"},(0,i.kt)("inlineCode",{parentName:"h3"},"totalAssets()")),(0,i.kt)("p",null,"Returns the sum of all fungible tokens controlled by the chain."),(0,i.kt)("p",null,"Returns:"),(0,i.kt)("p",null,"A map of ",(0,i.kt)("a",{parentName:"p",href:"#tokenid"},(0,i.kt)("inlineCode",{parentName:"a"},"TokenID"))," => ",(0,i.kt)("inlineCode",{parentName:"p"},"big.Int"),". The L1 base tokens is represented by an empty Token ID (a key with length 0)."),(0,i.kt)("h3",{id:"accounts"},(0,i.kt)("inlineCode",{parentName:"h3"},"accounts()")),(0,i.kt)("p",null,"Returns a list of all agent IDs that own assets on the chain."),(0,i.kt)("p",null,"Returns: a map of ",(0,i.kt)("inlineCode",{parentName:"p"},"AgentiD")," => ",(0,i.kt)("inlineCode",{parentName:"p"},"0xff"),"."),(0,i.kt)("h3",{id:"getnativetokenidregistry"},(0,i.kt)("inlineCode",{parentName:"h3"},"getNativeTokenIDRegistry()")),(0,i.kt)("p",null,"Returns a list of all native tokenIDs that are owned by the chain."),(0,i.kt)("p",null,"Returns: a map of ",(0,i.kt)("a",{parentName:"p",href:"#tokenid"},(0,i.kt)("inlineCode",{parentName:"a"},"TokenID"))," => ",(0,i.kt)("inlineCode",{parentName:"p"},"0xff")),(0,i.kt)("h3",{id:"foundryoutputs-foundryserialnumber"},(0,i.kt)("inlineCode",{parentName:"h3"},"foundryOutput(s FoundrySerialNumber)")),(0,i.kt)("p",null,"Returns the output corresponding to the foundry with Serial Number ",(0,i.kt)("inlineCode",{parentName:"p"},"s"),"."),(0,i.kt)("p",null,"Returns:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"b"),": ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/iotaledger/iota.go/blob/develop/output_foundry.go"},(0,i.kt)("inlineCode",{parentName:"a"},"iotago::FoundryOutput")))),(0,i.kt)("h3",{id:"accountnftsa-agentid"},(0,i.kt)("inlineCode",{parentName:"h3"},"accountNFTs(a AgentID)")),(0,i.kt)("p",null,"Returns the NFT IDs for all NFTs owned by the given account."),(0,i.kt)("p",null,"Parameters:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"a")," (",(0,i.kt)("inlineCode",{parentName:"li"},"AgentID"),"): The account Agent ID")),(0,i.kt)("p",null,"Returns:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"i")," (",(0,i.kt)("a",{parentName:"li",href:"https://github.com/dessaya/wasp/blob/develop/packages/kv/collections/array16.go"},(0,i.kt)("inlineCode",{parentName:"a"},"Array16"))," of ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/iotaledger/iota.go/blob/develop/output_nft.go"},(0,i.kt)("inlineCode",{parentName:"a"},"iotago::NFTID")),"): The NFT IDs owned by the account")),(0,i.kt)("h3",{id:"nftdataz-nftid"},(0,i.kt)("inlineCode",{parentName:"h3"},"nftData(z NFTID)")),(0,i.kt)("p",null,"Returns the data for a given NFT with ID ",(0,i.kt)("inlineCode",{parentName:"p"},"z")," that is on the chain."),(0,i.kt)("p",null,"Returns:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"e"),": ",(0,i.kt)("a",{parentName:"li",href:"#nftdata"},(0,i.kt)("inlineCode",{parentName:"a"},"NFTData")))),(0,i.kt)("h3",{id:"getaccountnoncea-agentid"},(0,i.kt)("inlineCode",{parentName:"h3"},"getAccountNonce(a AgentID)")),(0,i.kt)("p",null,"Returns the current account nonce for a give AgentID ",(0,i.kt)("inlineCode",{parentName:"p"},"a"),".\nThe account nonce is used to issue off-ledger requests."),(0,i.kt)("p",null,"Parameters:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"a")," (",(0,i.kt)("inlineCode",{parentName:"li"},"AgentID"),"): The account Agent ID")),(0,i.kt)("p",null,"Returns:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"n")," (",(0,i.kt)("inlineCode",{parentName:"li"},"uint64"),"): The account nonce")),(0,i.kt)("h2",{id:"schemas"},"Schemas"),(0,i.kt)("h3",{id:"tokenid"},(0,i.kt)("inlineCode",{parentName:"h3"},"TokenID")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"TokenID = [38]byte\n")),(0,i.kt)("h3",{id:"nftdata"},(0,i.kt)("inlineCode",{parentName:"h3"},"NFTData")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"NFTData")," is encoded as the concatenation of:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The issuer (",(0,i.kt)("a",{parentName:"li",href:"https://github.com/iotaledger/iota.go/blob/develop/address.go"},(0,i.kt)("inlineCode",{parentName:"a"},"iotago::Address")),")"),(0,i.kt)("li",{parentName:"ul"},"The NFT metadata: the length (",(0,i.kt)("inlineCode",{parentName:"li"},"uint16"),") followed by the data bytes"),(0,i.kt)("li",{parentName:"ul"},"The NFT owner (",(0,i.kt)("inlineCode",{parentName:"li"},"AgentID"),")")))}k.isMDXComponent=!0},3905:function(e,t,n){n.d(t,{Zo:function(){return s},kt:function(){return k}});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=a.createContext({}),u=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},s=function(e){var t=u(e.components);return a.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,c=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),p=u(n),k=o,m=p["".concat(c,".").concat(k)]||p[k]||d[k]||i;return n?a.createElement(m,r(r({ref:t},s),{},{components:n})):a.createElement(m,r({ref:t},s))}));function k(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=p;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var u=2;u<i;u++)r[u]=n[u];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"}}]);