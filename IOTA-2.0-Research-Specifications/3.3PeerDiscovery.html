<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.7">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="IOTA Wiki RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="IOTA Wiki Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="IOTA Wiki" href="/opensearch.xml">
<link rel="preconnect" href="${matomoUrl}">
<script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var a="https://matomo.antonionardella.it/";_paq.push(["setTrackerUrl",a+"matomo.php"]),_paq.push(["setSiteId","6"]);var e=document,t=e.createElement("script"),p=e.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=a+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Material+Icons">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">3.3 Peer Discovery | IOTA Wiki</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://wiki.iota.org/IOTA-2.0-Research-Specifications/3.3PeerDiscovery"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-IOTA-Research-Specifications-current"><meta data-react-helmet="true" property="og:title" content="3.3 Peer Discovery | IOTA Wiki"><meta data-react-helmet="true" name="description" content="This section defines the Peer Discovery protocol that you use to receive a list of verified peers. Here we explain how it works and what kind of requests and responses you could use."><meta data-react-helmet="true" property="og:description" content="This section defines the Peer Discovery protocol that you use to receive a list of verified peers. Here we explain how it works and what kind of requests and responses you could use."><meta data-react-helmet="true" name="keywords" content="peer,discovery,ping,pong,verification"><meta data-react-helmet="true" property="og:image" content="https://wiki.iota.org/img/research-specifications/peer-discovery.png"><meta data-react-helmet="true" name="twitter:image" content="https://wiki.iota.org/img/research-specifications/peer-discovery.png"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://wiki.iota.org/IOTA-2.0-Research-Specifications/3.3PeerDiscovery"><link data-react-helmet="true" rel="alternate" href="https://wiki.iota.org/IOTA-2.0-Research-Specifications/3.3PeerDiscovery" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://wiki.iota.org/IOTA-2.0-Research-Specifications/3.3PeerDiscovery" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.7fc50e40.css">
<link rel="preload" href="/assets/js/runtime~main.e805f9b9.js" as="script">
<link rel="preload" href="/assets/js/main.dccca95a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo_dark.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div></a><a class="navbar__item navbar__link" href="/learn/about-iota/an-introduction-to-iota"><div class="link"><div class="link__body"><div class="link__label">Learn</div></div></div></a><a class="navbar__item navbar__link" href="/participate/support-the-network/about-nodes"><div class="link"><div class="link__body"><div class="link__label">Participate</div></div></div></a><div class="dropdown dropdown--hoverable dropdown--mega"><a href="#" class="navbar__item navbar__link"><div class="link"><div class="link__body"><div class="link__label">Build</div></div></div></a><div class="dropdown__container"><div class="dropdown__menu"><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Getting Started</div></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Chrysalis (IOTA 1.5)</div></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Libraries</div></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Smart Contracts</div></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/build/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Getting Started</div><div class="link__sublabel">IOTA development basics</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/chrysalis-docs/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Chrysalis Docs</div><div class="link__sublabel">Mainnet documentation</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/iota.rs/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Core</div><div class="link__sublabel">IOTA core functionality</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/wasp/overview"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Wasp Node</div><div class="link__sublabel">Smart contract node</div></div></div></a></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/bee/getting_started/getting_started"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Bee Node</div><div class="link__sublabel">IOTA node written in Rust</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/wallet.rs/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Wallet</div><div class="link__sublabel">Build IOTA wallets</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Coordicide (IOTA 2.0)</div></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/hornet/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Hornet Node</div><div class="link__sublabel">IOTA node written in Go</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/stronghold.rs/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Stronghold</div><div class="link__sublabel">Handle secrets securely</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a aria-current="page" class="dropdown__link dropdown__link--active" href="/IOTA-2.0-Research-Specifications/Preface"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Coordicide Specs</div><div class="link__sublabel">Decentralizing IOTA</div></div></div></a></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/chronicle.rs/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Chronicle Permanode</div><div class="link__sublabel">IOTA permanode in Rust</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/identity.rs/introduction"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Identity</div><div class="link__sublabel">Identity framework</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/goshimmer/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">GoShimmer Node</div><div class="link__sublabel">IOTA 2.0 node</div></div></div></a></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/streams/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Streams</div><div class="link__sublabel">Share data securely</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"></div></div></div></div></div></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog"><div class="link"><div class="link__body"><div class="link__label">Blog</div></div></div></a><a class="navbar__item navbar__link" href="/team"><div class="link"><div class="link__body"><div class="link__label">Team</div></div></div></a><div class="toggle toggle_3Zt9 toggle--checked toggle--disabled" role="button" tabindex="-1"><div class="toggle__icon toggle__icon--unchecked" style="font-family:Material Icons">dark_mode</div><div class="toggle__icon toggle__icon--checked" style="font-family:Material Icons">light_mode</div><input type="checkbox" checked="" class="toggle__screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a tabindex="-1" class="sidebarLogo_3h0W" href="/"><img src="/img/logo.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo_dark.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--dark_hz6m"></a><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/preface">Preface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/1.1Introduction">1.1 Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/2.2MessageLayout">2.2 Message Layout</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/2.3StandardPayloadsLayout">2.3 Standard Payloads Layout</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/2.4DataFlow">2.4 Data flow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/IOTA-2.0-Research-Specifications/3.3PeerDiscovery">3.3 Peer Discovery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/3.4NeighborSelection">3.4 Neighbor Selection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/3.5 Manual Peering">3.5 Manual Peering</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.1TheTangle">4.1 The Tangle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.2Timestamps">4.2 Timestamps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.3TipSelectionAlgorithm">4.3 Tip Selection Algorithm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.4Solidification">4.4 Solidification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.5RateControl">4.5 Rate Control through Adaptive Proof of Work</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.6CongestionControl">4.6 Congestion control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.7Markers">4.7 Markers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/5.1UTXO">5.1 UTXO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/5.2LedgerState">5.2 Ledger State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/5.3Mana">5.3Mana</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.1ObjectsOfConsensus">6.1 Objects of Consensus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.2OpinionSetting">6.2 Opinion Setting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.3FastProbabilisticConsensus">6.3 Fast Probabilistic Consensus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.4Finalization">6.4 Approval Weight and Finality</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.5dRNG">6.5 Distributed Random Number Generator</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>3.3 Peer Discovery</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="331-introduction">3.3.1 Introduction<a aria-hidden="true" class="hash-link" href="#331-introduction" title="Direct link to heading">​</a></h2><p>This section defines the <em>Peer Discovery</em> protocol, its logic and the different requests and responses exchanged.</p><p>In order to establish connections, an IOTA node needs to discover and maintain a list of the reachable IP addresses of other peers. Moreover, some external modules, such as the <em>Neighbor Selection</em> and the <em>Fast Probabilistic Consensus (FPC)</em> may require an updated list of known peers.</p><p>The main goal of the <em>Peer Discovery</em> protocol is to expose an interface providing a list of all the verified peers.</p><p>Throughout this section the terms <code>Node</code> and <code>Peer</code> are used interchangeably to refer to a <code>Node</code> device.</p><p>The usage of the <em>Ping</em> and <em>Pong</em> mechanism is to be considered as a bidirectional exchange similarly to how described by other standards such as <a href="https://core-wg.github.io/coap-sig/" target="_blank" rel="noopener noreferrer">CoAP</a> and <a href="https://tools.ietf.org/html/rfc6455#section-5.5.2" target="_blank" rel="noopener noreferrer">WebSocket</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="332-detailed-design">3.3.2 Detailed Design<a aria-hidden="true" class="hash-link" href="#332-detailed-design" title="Direct link to heading">​</a></h2><p>To bootstrap the peer discovery, a node <em>must</em> be able to reach one or more entry nodes. To achieve this, the implementation of the protocol <em>shall</em> provide a hard-coded list of trusted <strong>entry nodes</strong> run by the IF or by trusted community members that answer to peer discovery packets coming from new nodes joining the IOTA network. This approach is a common practice of many distributed networks <a href="https://ieeexplore.ieee.org/iel7/9739/8649699/08456488.pdf" target="_blank" rel="noopener noreferrer">[Neudecker 2018]</a>.
Public Key-based Cryptography (PKC) <em>shall</em> be used for uniquely <a href="#3321-Node-identities">identifying</a> peers and for authenticating each packet.
The usage of the Ping and Pong protocols is that <a href="#Ping"><em>Ping</em></a> are sent to verify a given peer and, upon reception of a valid <a href="#Pong"><em>Pong</em></a> as a response from that peer, the peer is verified.
Once a peer has been verified, it can be queried to discover new peers by sending a <a href="#DiscoveryRequest"><em>DiscoveryRequest</em></a>. As a response, a <a href="#DiscoveryResponse"><em>DiscoveryResponse</em></a> <em>shall</em> be returned, containing a list of new peers. The new peer nodes in this list <em>shall</em> be verified by the receiving application.</p><p>This process is summarized in the following figure and detailed in the following subsections:</p><p><a target="_blank" href="/assets/files/peer-discovery-693ece6c7a10731425bbb474bea31ccf.png"><img alt="Peer discovery process" src="/assets/images/peer-discovery-693ece6c7a10731425bbb474bea31ccf.png"></a></p><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="3321-node-identities">3.3.2.1 Node Identities<a aria-hidden="true" class="hash-link" href="#3321-node-identities" title="Direct link to heading">​</a></h3><p>Every node has a cryptographic identity, a key on the ed25519 elliptic curve. The <code>blake2b</code> hash of the public key of the peer serves as its identifier or <code>node ID</code>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="3322-verification">3.3.2.2 Verification<a aria-hidden="true" class="hash-link" href="#3322-verification" title="Direct link to heading">​</a></h3><p>The verification process aims at both verifying peer identities and checking their online status. Each peer <em>shall</em> maintain a list of all the known peers. This list <em>shall</em> be called <code>known_peer_list</code>. Elements of any known peer list <em>shall</em> contain a reference to a <a href="#Peer">Peer</a> and a time at which it <em>shall</em> be verified/re-verified.
As such, the <code>known_peer_list</code> can be seen as a time-priority queue. A newly discovered peer gets added to the list at the current time. Whenever a peer is verified, its time value on the <code>known_peer_list</code> gets updated to the time at which that peer <em>shall</em> be re-verified.
The intent of this arrangement is to allow the node application to first verify newly discovered (and thus still unverified) peers and then to re-verify older peers (to confirm their online status) by iterating over the <code>known_peer_list</code>.
It is worthwhile to note that the order in which the <code>known_peer_list</code> is worked through is important. For example, if the peer is added to the front (&#x27;head&#x27;) of the <code>known_peer_list</code>, it is possible for an adversary to front-fill the <code>known_peer_list</code> with a selection of its own nodes. This is resolved by the use of the time-priority queue.</p><p>The verification process always initiates from a <a href="#Ping">Ping</a>. Upon reception of a <a href="#Ping">Ping</a>, a peer <em>shall</em> check its validity by:</p><ul><li>verifying that the signature of the <a href="#Ping">Ping</a> is valid and discarding the request otherwise;</li><li>checking that the <code>version</code> and <code>network_id</code> fields match its configuration and discarding the <a href="#Ping">Ping</a> otherwise;</li><li>checking that the <code>timestamp</code> field is fresh (i.e., not older than a given time) and discarding the packet otherwise;</li><li>checking that the <code>dest_addr</code> matches its IP address and discarding the <a href="#Ping">Ping</a> otherwise.</li></ul><p>Upon successful validation of a received <a href="#Ping">Ping</a>, a peer <em>shall</em> respond with a <a href="#Pong">Pong</a>. In case the sender of the <em>Ping</em> is a new peer from the perspective of the receiving node, the receiver peer <em>shall</em> add it to its <code>known_peer_list</code>. This enables the verification process to also occur in the reverse direction. </p><p>Upon reception of a <a href="#Pong">Pong</a>, a peer <em>shall</em> check its validity by:</p><ul><li>verifying that the signature of the <a href="#Pong">Pong</a> is valid and discarding it otherwise;</li><li>checking that the <code>req_hash</code> field matches a request (i.e. <em>Ping</em>) previously sent and not expired (i.e., the difference between the timestamp of the <em>Ping</em> and <em>Pong</em> is not greater than a given threshold) and discarding the associated <em>Ping</em> or <em>Pong</em> otherwise;</li><li>checking that the <code>dest_addr</code> matches its IP address and discarding the associated <em>Ping</em> or <em>Pong</em> otherwise.</li></ul><p>Upon successful validation of a received <a href="#Pong">Pong</a>, a peer <em>shall</em>:</p><ul><li>add the peer sender of the <em>Pong</em> to a list of verified peers called <code>verified_peer_list</code>;</li><li>move the peer entry of the <code>known_peer_list</code> to the tail.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="3323-removal">3.3.2.3 Removal<a aria-hidden="true" class="hash-link" href="#3323-removal" title="Direct link to heading">​</a></h3><p>While verifying a new peer, if no <em>Pong</em>, or an invalid <em>Pong</em> is received after <code>max_verify_attempts</code> attempts, that node <em>shall</em> be removed from the <code>known_peer_list</code>. Each expected reply should have a timeout such that if no answer is received after that, an attempt is considered concluded and counted as failed. </p><p>Each peer on the <code>verified_peer_list</code> <em>shall</em> be re-verified after <code>verification_lifetime</code> hours; while re-verifying a peer, if no <em>Pong</em>, or invalid <em>Pong</em> is received after <code>max_reverify_attempts</code> attempts, the peer <em>shall</em> be removed from the <code>verified_peer_list</code>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="3324-discovery">3.3.2.4 Discovery<a aria-hidden="true" class="hash-link" href="#3324-discovery" title="Direct link to heading">​</a></h3><p>Each peer entry of the <code>verified_peer_list</code> may be used to discover new peers. This process is initiated by sending a <a href="#DiscoveryRequest">DiscoveryRequest</a>.</p><p>Upon reception of a <a href="#DiscoveryRequest">DiscoveryRequest</a>, a peer node <em>shall</em> check its validity by:</p><ul><li>checking that the sender of the <a href="#DiscoveryRequest">DiscoveryRequest</a> is a verified peer (i.e. is stored in the <code>verified_peer_list</code>) and discarding the request otherwise;</li><li>verifying that the signature of the <a href="#DiscoveryRequest">DiscoveryRequest</a> is valid and discarding the request otherwise;</li><li>checking that the <code>timestamp</code> field is fresh (i.e., not older than a given time) and discarding the request otherwise.</li></ul><p>Upon successful validation of a received <a href="#DiscoveryRequest">DiscoveryRequest</a>, a peer <em>shall</em> reply with a <a href="#DiscoveryResponse">DiscoveryResponse</a>.</p><p>Upon reception of a <a href="#DiscoveryResponse">DiscoveryResponse</a>, a peer <em>shall</em> check its validity by:</p><ul><li>verifying that the signature of the <a href="#DiscoveryResponse">DiscoveryResponse</a> is valid and discarding the response otherwise;</li><li>checking that the <code>req_hash</code> field matches a discovery request (i.e. <em>DiscoveryRequest</em>) previously sent and not expired (i.e., the difference between the timestamp of the <em>DiscoveryRequest</em> and <em>DiscoveryResponse</em> is not greater than a given threshold) and discarding the response otherwise.</li></ul><p>Upon successful validation of a received <a href="#DiscoveryResponse">DiscoveryResponse</a>, a node <em>shall</em> add the nodes contained in the <code>peers</code> field to the <code>known_peer_list</code>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="3325-ping-and-pong-layout">3.3.2.5 Ping and Pong Layout<a aria-hidden="true" class="hash-link" href="#3325-ping-and-pong-layout" title="Direct link to heading">​</a></h3><p>Each <em>Ping</em> and <em>Pong</em> <em>shall</em> be encapsulated into a <code>data</code> field of a generic <code>Request</code> and <code>Response</code>. Its <code>type</code>  <em>shall</em> be specified in the <code>type</code> field. Each request and response <em>shall</em> be signed with the ed25519 private key of the sender&#x27;s <a href="#3321-Node-identities">identity</a> and <em>shall</em> contain the related public key, in order to allow the packet receiving node to verify the signature. All the received responses <em>shall</em> be verified and those with invalid signature <em>shall</em> be discarded.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="request-and-response-layout">Request and Response Layout<a aria-hidden="true" class="hash-link" href="#request-and-response-layout" title="Direct link to heading">​</a></h4><table><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td>type</td><td>uint8</td><td>Defines the type of the request or response.</td></tr><tr><td>data</td><td>ByteArray</td><td>contains the payload of the  request or response (e.g., a Ping).</td></tr><tr><td>public_key</td><td>ByteArray[32]</td><td>The ed25519 public key of the peer&#x27;s identity used to verify its signatures.</td></tr><tr><td>signature</td><td>ByteArray[32]</td><td>The ed25519 signature of the `data` field, signed by using the private key of the peer&#x27;s identity.</td></tr></table><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="ping">Ping<a aria-hidden="true" class="hash-link" href="#ping" title="Direct link to heading">​</a></h4><table><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td>version</td><td>uint32</td><td>The version of the protocol.</td></tr><tr><td>network_id</td><td>uint32</td><td>The network identifier.</td></tr><tr><td>timestamp</td><td>time</td><td>The unix timestamp of the Ping.</td></tr><tr><td>src_addr</td><td>string</td><td>The IP address, in string form, of the sender (e.g., &quot;192.0.2.1&quot;, &quot;[2001:db8::1]&quot;).</td></tr><tr><td>src_port</td><td>uint32</td><td>The listening port of the sender.</td></tr><tr><td>dst_addr</td><td>string</td><td>The string form of the receiver&#x27;s IP address. This provides a way to discover the external address (after NAT).</td></tr></table><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="pong">Pong<a aria-hidden="true" class="hash-link" href="#pong" title="Direct link to heading">​</a></h4><table><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td>req_hash</td><td>ByteArray[32]</td><td>The blake2b digest of the corresponding received Ping.</td></tr><tr><td colspan="1">services</td><td colspan="2"><details open="" class="details_2Ziz alert alert--info details_1VDD" data-collapsed="false"><summary>Services supported by the Pong sender.</summary><div><div class="collapsibleContent_3OHp"><table><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td>serviceID</td><td>ByteArray[32]</td><td>The service ID (e.g., autopeering, gossip, fpc).</td></tr><tr><td>network</td><td>string</td><td>The string form of the network (e.g., udp, tcp).</td></tr><tr><td>port</td><td>uint32</td><td>The listening port of the service.</td></tr></table></div></div></details></td></tr><tr><td>dst_addr</td><td>string</td><td>the string form of the receiver&#x27;s IP address. This MUST mirror the src_addr of the Ping&#x27;s IP packet. It provides a way to discover the external address (after NAT).</td></tr></table><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="discoveryrequest">DiscoveryRequest<a aria-hidden="true" class="hash-link" href="#discoveryrequest" title="Direct link to heading">​</a></h4><table><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td>timestamp</td><td>time</td><td>The unix timestamp of the DiscoveryRequest.</td></tr></table><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="discoveryresponse">DiscoveryResponse<a aria-hidden="true" class="hash-link" href="#discoveryresponse" title="Direct link to heading">​</a></h4><table><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td>req_hash</td><td>ByteArray[32]</td><td>The blake2b digest of the corresponding received DiscoveryRequest.</td></tr><tr><td colspan="1">peers</td><td colspan="2"><details open="" class="details_2Ziz alert alert--info details_1VDD" data-collapsed="false"><summary>The list of some randomly chosen peers known by the sender of the DiscoveryResponse <code>between(1,6). </code></summary><div><div class="collapsibleContent_3OHp"><table><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td>public_key</td><td>ByteArray[32]</td><td>The ed25519 public key of the peer&#x27;s identity used to verify its signature.</td></tr><tr><td>ip</td><td>string</td><td>The string form of the peer&#x27;s IP address.</td></tr><tr><td colspan="1">services</td><td colspan="2"><details open="" class="details_2Ziz alert alert--info details_1VDD" data-collapsed="false"><summary>Services supported by the peer.</summary><div><div class="collapsibleContent_3OHp"><table><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td>serviceID</td><td>ByteArray[32]</td><td>The service ID (e.g., autopeering, gossip, fpc).</td></tr><tr><td>network</td><td>string</td><td>The string form of the network (e.g., udp, tcp).</td></tr><tr><td>port</td><td>uint32</td><td>The listening port of the service.</td></tr></table></div></div></details></td></tr></table></div></div></details></td></tr></table><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="3326-denial-of-service">3.3.2.6 Denial of Service<a aria-hidden="true" class="hash-link" href="#3326-denial-of-service" title="Direct link to heading">​</a></h3><p>All the requests and responses exchanged during the Peer Discovery protocol are sent via UDP. As such, any UDP based Denial of Service attack could harm the normal functionality of the protocol. To limit this, hardware based protection such as Firewall or alternatively, rate limiting the incoming requests and responses via leaky/token buckets based techniques could be used.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/IOTA-2.0-Research-Specifications/2.4DataFlow"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->2.4 Data flow</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/IOTA-2.0-Research-Specifications/3.4NeighborSelection"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">3.4 Neighbor Selection<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#331-introduction" class="table-of-contents__link toc-highlight">3.3.1 Introduction</a></li><li><a href="#332-detailed-design" class="table-of-contents__link toc-highlight">3.3.2 Detailed Design</a><ul><li><a href="#3321-node-identities" class="table-of-contents__link toc-highlight">3.3.2.1 Node Identities</a></li><li><a href="#3322-verification" class="table-of-contents__link toc-highlight">3.3.2.2 Verification</a></li><li><a href="#3323-removal" class="table-of-contents__link toc-highlight">3.3.2.3 Removal</a></li><li><a href="#3324-discovery" class="table-of-contents__link toc-highlight">3.3.2.4 Discovery</a></li><li><a href="#3325-ping-and-pong-layout" class="table-of-contents__link toc-highlight">3.3.2.5 Ping and Pong Layout</a></li><li><a href="#3326-denial-of-service" class="table-of-contents__link toc-highlight">3.3.2.6 Denial of Service</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer padding--none"><div class="container"><div class="row footer__links padding-vert--xl"><div class="col footer__col"><h4 class="footer__title">LEARN</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/learn/about-iota/an-introduction-to-iota">About IOTA</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/iota-token/buying-iota">IOTA Token</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/wallets/what-is-a-wallet">Wallets</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/networks/iota-1.5-chrysalis">Networks</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/resource-materials/glossary">Resource Materials</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/research/research-outline">Research</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/future/future-of-iota">Future of IOTA</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">PARTICIPATE</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/participate/support-the-network/about-nodes">Support the network</a></li><li class="footer__item"><a class="footer__link-item" href="/participate/the-community/discord">The Community</a></li><li class="footer__item"><a href="https://www.iota.org/solutions/partnerships" target="_blank" rel="noopener noreferrer" class="footer__link-item">Partnerships</a></li><li class="footer__item"><a class="footer__link-item" href="/participate/funding/edf-funding">Funding</a></li><li class="footer__item"><a class="footer__link-item" href="/participate/use-cases/industry-applications">Use Cases</a></li><li class="footer__item"><a class="footer__link-item" href="/participate/frameworks/introduction">Frameworks</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">BUILD</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/build/welcome">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/build/fundamentals/cryptography">Fundamentals</a></li><li class="footer__item"><a class="footer__link-item" href="/build/exchange-integration/exchange-integration-guide">Exchange Integration</a></li><li class="footer__item"><a class="footer__link-item" href="/build/tutorials/twitch">Tutorials</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">WIKI</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/team">Team</a></li><li class="footer__item"><a href="https://github.com/iota-community/iota-wiki" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://github.com/jlvandenhout/docusaurus-plugin-docs-editor" target="_blank" rel="noopener noreferrer" class="footer__link-item">Editor Github</a></li><li class="footer__item"><a href="https://docusaurus.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus</a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/participate/contribute-to-wiki/welcome">Contribute</a></li></ul></div></div><div class="footer__bottom padding-bottom--xl"><div><a href="https://www.iota.org" target="_blank" rel="noopener noreferrer"><img src="/img/iota_logo.svg" alt="IOTA Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/iota_logo.svg" alt="IOTA Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">© 2021 IOTA Wiki. Built with Docusaurus.</div></div></div><div class="social"><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:var(--ifm-color-gray-900)" href="https://www.youtube.com/c/iotafoundation"><div class="social__font social__icon"></div><div class="social__title">Youtube</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#2C3850" href="https://www.github.com/iotaledger/"><div class="social__font social__icon"></div><div class="social__title">GitHub</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#4B576F" href="https://discord.iota.org/"><div class="social__font social__icon"></div><div class="social__title">Discord</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#6A768E" href="https://www.twitter.com/iota/"><div class="social__font social__icon"></div><div class="social__title">Twitter</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#7D89A1" href="https://www.reddit.com/r/iota/"><div class="social__font social__icon"></div><div class="social__title">Reddit</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#8995AD" href="https://www.linkedin.com/company/iotafoundation/"><div class="social__font social__icon"></div><div class="social__title">Linkedin</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#99A5BD" href="https://www.instagram.com/iotafoundation/"><div class="social__font social__icon"></div><div class="social__title">Instagram</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#BAC6DE" href="https://www.facebook.com/TheIOTAFoundation/"><div class="social__font social__icon"></div><div class="social__title">Facebook</div></a></div></footer></div>
<script src="/assets/js/runtime~main.e805f9b9.js"></script>
<script src="/assets/js/main.dccca95a.js"></script>
</body>
</html>