<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="IOTA Wiki Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="IOTA Wiki Blog Atom Feed">
<link rel="preconnect" href="${matomoUrl}">
<script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var a="https://matomo.antonionardella.it/";_paq.push(["setTrackerUrl",a+"matomo.php"]),_paq.push(["setSiteId","6"]);var e=document,t=e.createElement("script"),p=e.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=a+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Material+Icons">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">4.5 Rate Control through Adaptive Proof of Work | IOTA Wiki</title><meta data-react-helmet="true" property="og:url" content="https://wiki.iota.org/IOTA-2.0-Research-Specifications/4.5 Rate Control"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-IOTA-Research-Specifications-current"><meta data-react-helmet="true" property="og:title" content="4.5 Rate Control through Adaptive Proof of Work | IOTA Wiki"><meta data-react-helmet="true" name="description" content="4.5.1 Introduction"><meta data-react-helmet="true" property="og:description" content="4.5.1 Introduction"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://wiki.iota.org/IOTA-2.0-Research-Specifications/4.5 Rate Control"><link data-react-helmet="true" rel="alternate" href="https://wiki.iota.org/IOTA-2.0-Research-Specifications/4.5 Rate Control" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://wiki.iota.org/IOTA-2.0-Research-Specifications/4.5 Rate Control" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.d3d63b2e.css">
<link rel="preload" href="/assets/js/runtime~main.642472dd.js" as="script">
<link rel="preload" href="/assets/js/main.d9172a5a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#ff0000;color:#fff" role="banner"><div class="announcementBarContent_3EUC">This Wiki is still a Work in Progress. Consider contributing by using the in page editor or creating a <a href="https://github.com/iota-community/iota-wiki">PR directly</a></div></div><nav class="navbar navbar--fixed-top navbarHideable_1VR7"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo_dark.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link" href="/docs/learn/about-iota/an-introduction-to-iota">Learn</a><a class="navbar__item navbar__link" href="/docs/use/use-cases/industry-applications">Use</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__item navbar__link">Develop</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/develop/getting-started/architecture">Getting Started</a></li><li><a class="dropdown__link" href="/bee/getting_started/getting_started">Bee</a></li><li><a class="dropdown__link" href="/chrysalis-docs/welcome">Chrysalis docs</a></li><li><a class="dropdown__link" href="/goshimmer/welcome">GoShimmer</a></li><li><a class="dropdown__link" href="/hornet/welcome">Hornet</a></li><li><a class="dropdown__link" href="/identity.rs/intro">Identity</a></li><li><a class="dropdown__link" href="/IOTA-2.0-Research-Specifications/Preface">IOTA 2.0 Specs</a></li><li><a class="dropdown__link" href="/iota.rs/welcome">iota.rs</a></li><li><a class="dropdown__link" href="/stronghold.rs/welcome">stronghold.rs</a></li><li><a class="dropdown__link" href="/wallet.rs/welcome">wallet.rs</a></li><li><a class="dropdown__link" href="/wasp/welcome">Wasp</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/participate/support-the-network/run-a-node">Participate</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog">Blog</a><div class="wiki-search" role="button" tabindex="-1"><div class="wiki-search-opened"><span class="toggle_10iL" style="font-family:Material Icons">close</span></div><div class="wiki-search-closed"><span class="toggle_10iL" style="font-family:Material Icons">search</span></div><input type="checkbox" class="wiki-search-screenreader-only" aria-label="Open and close search"></div><div class="wiki-search-page"><div class="wiki-search-header"></div><div class="wiki-search-main"><div class="wiki-search-bar"><div class="wiki-search-logo"><span class="toggle_10iL" style="font-family:Material Icons">search</span></div><input class="wiki-search-input"></div></div></div><div class="react-toggle toggle_2xs0 react-toggle--checked react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3D-N" style="font-family:Material Icons">light_mode</span></div><div class="react-toggle-track-x"><span class="toggle_3D-N" style="font-family:Material Icons">dark_mode</span></div></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a tabindex="-1" class="sidebarLogo_3h0W" href="/"><img src="/img/logo.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo_dark.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--dark_hz6m"></a><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/preface">Preface</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/1.1 Introduction">1.1 Introduction</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/2.2 Message Layout">2.2 Message Layout</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/2.3 Standard Payloads Layout">2.3 Standard Payloads Layout</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/2.4 Data Flow">2.4 Data flow</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/3.3 Peer Discovery">3.3 Peer Discovery</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/3.4 Neighbor Selection">3.4 Neighbor Selection</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.1 The Tangle">4.1 The Tangle</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.2 Timestamps">4.2 Timestamps</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.3 Tip Selection Algorithm">4.3 Tip Selection Algorithm</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.4 Solidification">4.4 Solidification</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/IOTA-2.0-Research-Specifications/4.5 Rate Control">4.5 Rate Control through Adaptive Proof of Work</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.6 Congestion Control">4.6 Congestion control</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.7 Markers">4.7 Markers</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/5.1 UTXO">5.1 UTXO</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/5.2 Ledger State">5.2 Ledger State</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/5.3 Mana">5.3 Mana</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.1 Objects of Consensus">6.1 Objects of Consensus</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.2 Opinion Setting">6.2 Opinion Setting</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.3 Fast Probabilistic Consensus">6.3 Fast Probabilistic Consensus</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.4 Finalization">6.4 Approval Weight and Finality</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.5 dRNG">6.5 Distributed Random Number Generator</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">4.5 Rate Control through Adaptive Proof of Work</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="451-introduction"></a>4.5.1 Introduction<a class="hash-link" href="#451-introduction" title="Direct link to heading">#</a></h2><p>In Proof of Work-based blockchains, a built-in rate limit is enforced by the mining difficulty adjustment and the message fees. Without this filter, however, an attacker may be able to easily issue a very large number of messages to potentially harm the network. In order to enable the machine-to-machine economy, IOTA does not allow neither mining race nor fees, which makes an <em>explicit rate control mechanism necessary</em>. In order to ensure that the network traffic does not exceed the allowed throughput determined by the limited resources, it is fundamental to limit the number of messages issued at node level.</p><p>The mechanisms described act as an emergency break during spam attacks, by slowing down the rate of messages a node can issue.  For honest nodes, the proof of work difficulty should be small enough not to hamper performance.  Finer controls on the access are developed in <a href="/IOTA-2.0-Research-Specifications/4.6 Congestion Control">Section 4.6 - Congestion Control</a>, which regulate network traffic during normal periods of congestion.</p><p>The Rate Control specification depends on the following specifications:</p><ul><li><p><a href="/IOTA-2.0-Research-Specifications/3.3 Peer Discovery">3.3 - Peer Discovery</a></p></li><li><p><a href="/IOTA-2.0-Research-Specifications/4.2 Timestamps">4.2 - Timestamps</a></p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="4511-legacy-implementation"></a>4.5.1.1 Legacy implementation<a class="hash-link" href="#4511-legacy-implementation" title="Direct link to heading">#</a></h3><p>In the legacy IOTA implementation, a user is asked to solve a proof of work (PoW) before issuing a new message. The user can either perform that computation locally or outsource it to a third-party service.</p><p>In the legacy network, the difficulty of the PoW is set to some value <code>POW_DIFFICULTY</code>. Received messages are stored in a queue and processed in FIFO order. The protocol dictates that the nodes forward messages if and only if the difficulty of the PoW performed is greater or equal to <code>POW_DIFFICULTY</code>. Otherwise, messages <em>shall</em> be dropped.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="4512-proposal"></a>4.5.1.2 Proposal<a class="hash-link" href="#4512-proposal" title="Direct link to heading">#</a></h3><p>Similar to the legacy implementation, we require the solution of a given cryptographic puzzle before a message is issued. Here, however, we impose that the difficulty of the challenge progressively increases as a node issues multiple messages in a short time interval.</p><p>The goal of this document is to define this rate control mechanism, called <em>Adaptive PoW</em> (APoW), which permits nodes&#x27; theoretical throughput to be independent on their hardware equipment. We believe that this mechanism is fundamental to prevent spam and denial-of-service attacks, disallowing dishonest nodes from inflating their neighbors&#x27; buffers through large number of messages in a short time. Unlike APoW, the congestion control mechanism described in [Section 4.6 - Congestion Control](./4.6 Congestion Control.md) sets the actual throughput depending on nodes&#x27; access Mana, and protects the protocol against Sybil attacks and selfish behavior.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="452-adaptive-proof-of-work"></a>4.5.2 Adaptive Proof of Work<a class="hash-link" href="#452-adaptive-proof-of-work" title="Direct link to heading">#</a></h2><p>All nodes in the network have knowledge of the following three fixed global parameters:</p><ul><li><em>Base difficulty <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>d</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(d_0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></em>. It sets the initial difficulty of PoW.</li><li><em>Adaptation rate <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>γ</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\gamma\in [0, 1])</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05556em">γ</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord">1</span><span class="mclose">]</span><span class="mclose">)</span></span></span></span></span></em>. It provides the rate at which difficulty will be adjusted. Equivalently, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi mathvariant="normal">/</mi><mi>γ</mi></mrow><annotation encoding="application/x-tex">1/\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">1</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.05556em">γ</span></span></span></span></span> indicates how many messages can be sent per time window without increasing the PoW difficulty.</li><li><em>APoW time window <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>w</mi><mo>&gt;</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(w&gt;0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02691em">w</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">0</span><span class="mclose">)</span></span></span></span></span></em>. It describes the width of the time interval considered by the algorithm, i.e., its granularity.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="4521-message-generation"></a>4.5.2.1 Message generation<a class="hash-link" href="#4521-message-generation" title="Direct link to heading">#</a></h3><p>Let <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em"></span><span class="mord mathnormal">t</span></span></span></span></span> be the output of the function <code>CurrentTime()</code>. If node <code>m</code> wants to issue a new message, it <em>shall</em> perform a PoW with difficulty <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>m</mi></msub><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d_m(t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span></span> such that</p><p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>m</mi></msub><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mi>d</mi><mn>0</mn></msub><mo>+</mo><mrow><mo fence="true">⌊</mo><mrow><mi>γ</mi><mo>⋅</mo><msub><mi>r</mi><mi>m</mi></msub><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow><mo fence="true">⌋</mo></mrow></mrow><annotation encoding="application/x-tex">d_m(t) = d_0 + \left \lfloor{\gamma\cdot r_m(t)}\right \rfloor</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="minner"><span class="mopen delimcenter" style="top:0em">⌊</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05556em">γ</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span></span><span class="mclose delimcenter" style="top:0em">⌋</span></span></span></span></span></span></p><p>where <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mi>m</mi></msub><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">r_m(t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span></span> represents the number of messages issued by node <em>m</em> with (message) timestamp in the interval <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>t</mi><mo>−</mo><mi>w</mi><mo separator="true">,</mo><mi>t</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[t-w, t]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">[</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.02691em">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">t</span><span class="mclose">]</span></span></span></span></span>. Note that when <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\gamma = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord mathnormal" style="margin-right:0.05556em">γ</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">0</span></span></span></span></span>, the algorithm becomes equivalent to the legacy IOTA implementation.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="4522-message-verification"></a>4.5.2.2 Message verification<a class="hash-link" href="#4522-message-verification" title="Direct link to heading">#</a></h3><p>When a node <code>n</code> receives a message from a neighbor, it shall check that PoW with an appropriate difficulty was performed. The verification of the correctness of the PoW computation is the last step of the parser checks, right after signature verification (see [Section 2.4 - Data Flow](./2.4 Data flow.md)). Let us assume that node <code>n</code> receives a message with difficulty <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>m</mi></msub></mrow><annotation encoding="application/x-tex">d_m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span> issued by node <code>m</code>. To decide whether this message should be discarded, node <code>n</code> counts how many messages <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mi>m</mi></msub><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">r_m(t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span></span> issued by <code>m</code> it has received in the last <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.02691em">w</span></span></span></span></span> time units. In accordance with the formula above, the node validates the PoW only if the following condition is satisfied:</p><p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>m</mi></msub><mo>≥</mo><msub><mi>d</mi><mn>0</mn></msub><mo>+</mo><mrow><mo fence="true">⌊</mo><mrow><mi>γ</mi><mo>⋅</mo><msub><mi>r</mi><mi>m</mi></msub><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow><mo fence="true">⌋</mo></mrow><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">d_m \geq d_0 + \left\lfloor{\gamma\cdot r_m(t)}\right\rfloor.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="minner"><span class="mopen delimcenter" style="top:0em">⌊</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05556em">γ</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span></span><span class="mclose delimcenter" style="top:0em">⌋</span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord">.</span></span></span></span></span></p><p>Discussions on the correctness of this procedure can be found on a <a href="https://iota.cafe/t/adaptive-pow-without-sequence-numbers/363" target="_blank" rel="noopener noreferrer">related article</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="453-algorithm"></a>4.5.3 Algorithm<a class="hash-link" href="#453-algorithm" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="4531-protocol-parameters"></a>4.5.3.1 Protocol parameters<a class="hash-link" href="#4531-protocol-parameters" title="Direct link to heading">#</a></h3><p>In line with the previous section, all nodes know the constants shown by Table 4.5.1.</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>POW_BASE</code></td><td>integer</td><td>The base difficulty <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">d_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span></td></tr><tr><td><code>APOW_RATE</code></td><td>float</td><td>The adaptation rate <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord mathnormal" style="margin-right:0.05556em">γ</span></span></span></span></span> (proposed values [0.1 - 1])</td></tr><tr><td><code>APOW_WINDOW</code></td><td>integer</td><td>The APoW time window <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.02691em">w</span></span></span></span></span> (proposed values [10 - 60s])</td></tr></tbody></table><p><strong>Table 4.5.1:</strong>  Global constants.</p><p>The choice of the time window is crucial in the correct functioning of the algorithm. Our claim is that the time window must be kept small for two main reasons:</p><ul><li>Message burst can be captured;</li><li>Implementation is easier as it requires smaller caches.</li></ul><p>However, it is fundamental to keep this time window at least larger than the gratuitous network delay <code>DLARGE</code> (see [Section 4.2 - Timestamps](./4.2 Timestamps.md)).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="4532-local-variables-and-metadata"></a>4.5.3.2 Local variables and metadata<a class="hash-link" href="#4532-local-variables-and-metadata" title="Direct link to heading">#</a></h3><p>Local variables and metadata are described in Table 4.5.2.</p><table><thead><tr><th>Variable/Metadata</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>timestamp</code></td><td>integer</td><td>A value declared by the node representing time at which the message has been issued</td></tr><tr><td><code>nodeID</code></td><td>nodeID</td><td>Identity of the node issuing the message defined as the <code>blake2b</code> hash of its public key</td></tr><tr><td><code>targetDifficulty</code></td><td>integer</td><td>Minimum difficulty needed to pass the APoW verification</td></tr><tr><td><code>powCheck</code></td><td>boolean</td><td>Boolean value which indicates whether the APoW verification is successful or not</td></tr><tr><td><code>ownId</code></td><td>nodeID</td><td>Identity of the node running the algorithm</td></tr><tr><td><code>msgCache</code></td><td>list</td><td>Cache storing the timestamp of the most recent messages received by <code>ownID</code></td></tr><tr><td><code>nodeMap</code></td><td>list</td><td>List of nodeIDs which have issued messages recently (within 2 APoW timestamp windows)</td></tr></tbody></table><p><strong>Table 4.5.2:</strong> Local variables and metadata.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="4533-built-in-functions"></a>4.5.3.3 Built-in functions<a class="hash-link" href="#4533-built-in-functions" title="Direct link to heading">#</a></h3><p>Pseudocodes introduced in the next section will use the built-in functions described in Table 4.5.3.</p><table><thead><tr><th>Function</th><th>Description</th></tr></thead><tbody><tr><td><code>Floor(x)</code></td><td>Give the greatest integer less than or equal to <code>x</code></td></tr><tr><td><code>Sort(x, y)</code></td><td>Sort list <code>x</code> by metric <code>y</code></td></tr><tr><td><code>Append(x, y)</code></td><td>Add a new element <code>y</code> to list <code>x</code></td></tr><tr><td><code>Remove(x)</code></td><td>Remove the oldest element from the ordered data structure <code>x</code></td></tr><tr><td><code>Head(x)</code></td><td>Get (without removing) the oldest element from the ordered data structure <code>x</code></td></tr><tr><td><code>CurrentTime()</code></td><td>Current time computed with the local clock</td></tr></tbody></table><p><strong>Table 4.5.3:</strong> Built-in functions.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="4534-pseudocode"></a>4.5.3.4 Pseudocode<a class="hash-link" href="#4534-pseudocode" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="targetpowtimestamp-nodeid"></a><code>TargetPoW(timestamp, nodeID)</code><a class="hash-link" href="#targetpowtimestamp-nodeid" title="Direct link to heading">#</a></h4><p>This function accesses the ledger to check the history of messages for <code>nodeId</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly vbnet"><pre tabindex="0" class="prism-code language-vbnet codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">FUNCTION targetPoW = TargetPoW(timestamp, nodeID)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # cache update (this is done as an optimization)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    WHILE CurrentTime() - Head(msgCache).timestamp &gt;  2 * APOW_WINDOW</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Remove(msgCache)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Append(msgCache, &lt;nodeID, timestamp&gt;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Sort(msgCache, `timestamp`)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    countMsg = 0</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    FOR msg IN msgCache[nodeID]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        IF msg &gt; timestamp - APOW_WINDOW AND msg &lt; timestamp</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            countMsg++</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    RETURN BASE_POW + Floor(APOW_RATE * countMsg)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="apowgeneration"></a><code>APoWGeneration()</code><a class="hash-link" href="#apowgeneration" title="Direct link to heading">#</a></h4><p>This function sets the difficulty at which the message creator should compute the PoW when generating a new message.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly vbnet"><pre tabindex="0" class="prism-code language-vbnet codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">### upon creation of a new message</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">FUNCTION targetPoW = APoWGeneration()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    RETURN TargetPoW(CurrentTime(), ownID)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="apowverificationmsg"></a><code>APoWVerification(msg)</code><a class="hash-link" href="#apowverificationmsg" title="Direct link to heading">#</a></h4><p>This function is triggered in the parser by new messages, see [Section 2.4 - Data Flow](./2.4 Data flow.md). It returns <code>TRUE</code> if the PoW attached to the message is sufficient, or <code>FALSE</code> otherwise.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly vbnet"><pre tabindex="0" class="prism-code language-vbnet codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#### upon arrival of a message msg</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">FUNCTION powCheck = APoWVerification(msg)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    targetPoW = TargetPoW(msg.timestamp, msg.nodeID)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    IF msg.pow &gt;= targetPoW</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        IF nodeMap[msg.nodeID] == NULL</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            Append(nodeMap, msg.nodeID)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Append(msgCache, msg.timestamp)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        RETURN TRUE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ELSE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        RETURN FALSE</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="4535-implementation"></a>4.5.3.5 Implementation<a class="hash-link" href="#4535-implementation" title="Direct link to heading">#</a></h3><p>The most critical part of the algorithm concerns counting the number of messages recently issued by a node. Since querying the database may be expensive, we propose to cache the most recent messages. To this end, we use two data structures (see Image 4.5.4):</p><ul><li><code>nodeMap</code>. Each entry in the hashmap corresponds to a different nodeId and points to the doubly linked list of recent messages of the same node.</li><li><code>msgCache</code>. A queue which removes old messages and adds new ones according to a FIFO policy.</li></ul><p><img src="https://i.imgur.com/vgbhyJO.png"></p><p><strong>Image 4.5.4:</strong> Proposed data structures for the implementation of the rate control mechanism.</p><p>Both data structures point to the same locations of memory which store the timestamp of the message. These locations of memory also store the pointers to the other elements of <em>nodeMap</em> and <em>msgCache</em>.</p><p>The size of the cache <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.07153em">C</span></span></span></span></span> (in number of timestamps) must be larger of the product between the maximum network throughput and the time window <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.02691em">w</span></span></span></span></span>. Assume that max throughput is 1000 TPS and the time window is 50 s, cache size must be larger than 50,000. Given <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.10903em">N</span></span></span></span></span> the number of nodes issuing recent messages, our caching scheme provides the following performance:</p><ul><li>cache update: <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em">O</span></span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span>;</li><li>msg counter: <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">O</mi><mo stretchy="false">(</mo><mi>C</mi><mi mathvariant="normal">/</mi><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(C/N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em">O</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="mclose">)</span></span></span></span></span>;</li><li>cache size: <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">&lt;10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">1</span><span class="mord">0</span></span></span></span></span> MB.</li></ul><p>Assume that a node receives a message with PoW difficulty equal to <em>targetPoW</em>. However, the node cannot (immediately) know whether older messages have been issued before the timestamp of such message, which would make its PoW not sufficient. In this case, in order not to slow down the network, the node will forward anyway the message for scheduling.</p><p>An attacker may exploit the above in order to issue progressively older messages which would be accepted with easier PoW difficulty. Since the timestamp validation window is pretty large, this attack may theoretically be effective.</p><p>In case a node receives a new message with a timestamp that would make other messages from the same node would not have the correct PoW difficulty, the node will be blacklisted. However, no transactions which are already scheduled would be dropped.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/IOTA-2.0-Research-Specifications/4.4 Solidification"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 4.4 Solidification</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/IOTA-2.0-Research-Specifications/4.6 Congestion Control"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">4.6 Congestion control »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#451-introduction" class="table-of-contents__link">4.5.1 Introduction</a><ul><li><a href="#4511-legacy-implementation" class="table-of-contents__link">4.5.1.1 Legacy implementation</a></li><li><a href="#4512-proposal" class="table-of-contents__link">4.5.1.2 Proposal</a></li></ul></li><li><a href="#452-adaptive-proof-of-work" class="table-of-contents__link">4.5.2 Adaptive Proof of Work</a><ul><li><a href="#4521-message-generation" class="table-of-contents__link">4.5.2.1 Message generation</a></li><li><a href="#4522-message-verification" class="table-of-contents__link">4.5.2.2 Message verification</a></li></ul></li><li><a href="#453-algorithm" class="table-of-contents__link">4.5.3 Algorithm</a><ul><li><a href="#4531-protocol-parameters" class="table-of-contents__link">4.5.3.1 Protocol parameters</a></li><li><a href="#4532-local-variables-and-metadata" class="table-of-contents__link">4.5.3.2 Local variables and metadata</a></li><li><a href="#4533-built-in-functions" class="table-of-contents__link">4.5.3.3 Built-in functions</a></li><li><a href="#4534-pseudocode" class="table-of-contents__link">4.5.3.4 Pseudocode</a></li><li><a href="#4535-implementation" class="table-of-contents__link">4.5.3.5 Implementation</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer padding--none padding-top--xl"><div class="row footer__links padding-top--lg padding-bottom--xl"><div class="col footer__col"><h4 class="footer__title">LEARN</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/learn/about-iota/an-introduction-to-iota">About IOTA</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/iota-token/overview">IOTA Token</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/wallets/what-is-a-wallet">Wallets</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/networks/iota-1.5-chrysalis">Networks</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/resource-materials/glossary">Resource Materials</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/research/research-outline">Research</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">USE</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/use/use-cases/industry-applications">Use Cases</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/use/streams/encrypted-data-comms">Streams</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/use/identity/enabling-privacy-and-trust">Identity</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/use/access/secure-access-control">Access</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/use/smart-contracts/programmable-contracts">Smart Contracts</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/use/stronghold/protecting-your-secrets">Stronghold</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/use/oracles/trust-in-real-world-data">Oracles</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/use/utilities/tangle-explorer">Utilities</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">DEVELOP</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/develop/getting-started/architecture">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/develop/fundamentals/cryptography">Fundamentals</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/develop/exchange-integration/guide">Exchange Integration</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/develop/tutorials/youtube">Tutorials</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">PARTICIPATE</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/participate/support-the-network/run-a-node">Support the network</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/the-community/discord">The Community</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/partnerships/iota-partnerships">Partnerships</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/funding/edf-funding">Funding</a></li></ul></div></div><div class="footer__bottom padding-top--xl padding-bottom--lg"><div><a href="https://www.iota.org" target="_blank" rel="noopener noreferrer"><img src="/img/iota_logo.svg" alt="IOTA Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/iota_logo_dark.svg" alt="IOTA Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">© 2021 IOTA Wiki, Built with Docusaurus.</div></div><div class="socialBar_2nY3"><a class="padding-horiz--sm padding-vert--md socialLink_1As6" style="background-color:#18243C" href="https://www.youtube.com/c/iotafoundation"><img class="socialImage_2plZ" src="/img/youtube.svg"><div class="socialTitle_3JEm">Youtube</div></a><a class="padding-horiz--sm padding-vert--md socialLink_1As6" style="background-color:#24314A" href="https://www.github.com/iotaledger/"><img class="socialImage_2plZ" src="/img/github.svg"><div class="socialTitle_3JEm">GitHub</div></a><a class="padding-horiz--sm padding-vert--md socialLink_1As6" style="background-color:#303C56" href="https://discord.iota.org/"><img class="socialImage_2plZ" src="/img/discord.svg"><div class="socialTitle_3JEm">Discord</div></a><a class="padding-horiz--sm padding-vert--md socialLink_1As6" style="background-color:#3B4862" href="https://www.twitter.com/iota/"><img class="socialImage_2plZ" src="/img/twitter.svg"><div class="socialTitle_3JEm">Twitter</div></a><a class="padding-horiz--sm padding-vert--md socialLink_1As6" style="background-color:#47546F" href="https://www.reddit.com/r/iota/"><img class="socialImage_2plZ" src="/img/reddit.svg"><div class="socialTitle_3JEm">Reddit</div></a><a class="padding-horiz--sm padding-vert--md socialLink_1As6" style="background-color:#52607B" href="https://www.linkedin.com/company/iotafoundation/"><img class="socialImage_2plZ" src="/img/linkedin.svg"><div class="socialTitle_3JEm">Linkedin</div></a><a class="padding-horiz--sm padding-vert--md socialLink_1As6" style="background-color:#5E6B87" href="https://www.instagram.com/iotafoundation/"><img class="socialImage_2plZ" src="/img/instagram.svg"><div class="socialTitle_3JEm">Instagram</div></a></div></footer></div>
<script src="/assets/js/runtime~main.642472dd.js"></script>
<script src="/assets/js/main.d9172a5a.js"></script>
</body>
</html>