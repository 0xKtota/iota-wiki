<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="IOTA Wiki Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="IOTA Wiki Blog Atom Feed">
<link rel="preconnect" href="${matomoUrl}">
<script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var a="https://matomo.antonionardella.it/";_paq.push(["setTrackerUrl",a+"matomo.php"]),_paq.push(["setSiteId","6"]);var e=document,t=e.createElement("script"),p=e.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=a+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Material+Icons">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">6.2 Opinion Setting | IOTA Wiki</title><meta data-react-helmet="true" property="og:url" content="https://wiki.iota.org/IOTA-2.0-Research-Specifications/6.2 Opinion Setting"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-IOTA-Research-Specifications-current"><meta data-react-helmet="true" property="og:title" content="6.2 Opinion Setting | IOTA Wiki"><meta data-react-helmet="true" name="description" content="6.2.1 Preliminaries"><meta data-react-helmet="true" property="og:description" content="6.2.1 Preliminaries"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://wiki.iota.org/IOTA-2.0-Research-Specifications/6.2 Opinion Setting"><link data-react-helmet="true" rel="alternate" href="https://wiki.iota.org/IOTA-2.0-Research-Specifications/6.2 Opinion Setting" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://wiki.iota.org/IOTA-2.0-Research-Specifications/6.2 Opinion Setting" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.71942b32.css">
<link rel="preload" href="/assets/js/runtime~main.25fc0cbb.js" as="script">
<link rel="preload" href="/assets/js/main.d75ef5b9.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#ff0000;color:#fff" role="banner"><div class="announcementBarContent_3EUC">The work on this Wiki is still in progress. Consider contributing by using the in page editor or creating a <a href="https://github.com/iota-community/iota-wiki">PR directly</a></div></div><nav class="navbar navbar--fixed-top navbarHideable_1VR7"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo_dark.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link" href="/docs/learn/about-iota/an-introduction-to-iota">Learn</a><a class="navbar__item navbar__link" href="/docs/use/use-cases/industry-applications">Use</a><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="icon-iota-20 navbar__link--active" href="/IOTA-2.0-Research-Specifications/Preface">Develop &gt; Coordicide Specs</a><ul class="dropdown__menu"><li><a class="dropdown__link icon-getting-started" href="/docs/develop/getting-started/architecture">Getting Started</a></li><li style="font-size:10px;color:var(--ifm-color-emphasis-600);padding-top:10px">Chrysalis (IOTA 1.5)</li><li><a class="dropdown__link icon-chrysalis" href="/chrysalis-docs/welcome">Chrysalis Docs</a></li><li><a class="dropdown__link icon-bee" href="/bee/getting_started/getting_started">Bee Node</a></li><li><a class="dropdown__link icon-hornet" href="/hornet/welcome">Hornet Node</a></li><li style="font-size:10px;color:var(--ifm-color-emphasis-600);padding-top:10px">Libraries</li><li><a class="dropdown__link icon-iota-mark" href="/iota.rs/welcome">Core</a></li><li><a class="dropdown__link icon-wallet" href="/wallet.rs/welcome">Wallet</a></li><li><a class="dropdown__link icon-stronghold" href="/stronghold.rs/welcome">Stronghold</a></li><li><a class="dropdown__link icon-identity" href="/identity.rs/intro">Identity</a></li><li style="font-size:10px;color:var(--ifm-color-emphasis-600);padding-top:10px">Smart Contracts</li><li><a class="dropdown__link icon-wasp" href="/wasp/welcome">Wasp Node</a></li><li style="font-size:10px;color:var(--ifm-color-emphasis-600);padding-top:10px">Coordicide (IOTA 2.0)</li><li><a aria-current="page" class="dropdown__link icon-iota-20 dropdown__link--active" href="/IOTA-2.0-Research-Specifications/Preface">Coordicide Specs</a></li><li><a class="dropdown__link icon-goshimmer" href="/goshimmer/welcome">GoShimmer Node</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/participate/support-the-network/run-a-node">Participate</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog">Blog</a><div class="wiki-search" role="button" tabindex="-1"><div class="wiki-search-opened"><span class="toggle_10iL" style="font-family:Material Icons">close</span></div><div class="wiki-search-closed"><span class="toggle_10iL" style="font-family:Material Icons">search</span></div><input type="checkbox" class="wiki-search-screenreader-only" aria-label="Open and close search"></div><div class="wiki-search-page"><div class="wiki-search-header"></div><div class="wiki-search-main"><div class="wiki-search-bar"><div class="wiki-search-logo"><span class="toggle_10iL" style="font-family:Material Icons">search</span></div><input class="wiki-search-input"></div></div></div><div class="react-toggle toggle_2xs0 react-toggle--checked react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3D-N" style="font-family:Material Icons">light_mode</span></div><div class="react-toggle-track-x"><span class="toggle_3D-N" style="font-family:Material Icons">dark_mode</span></div></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a tabindex="-1" class="sidebarLogo_3h0W" href="/"><img src="/img/logo.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo_dark.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--dark_hz6m"></a><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/preface">Preface</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/1.1 Introduction">1.1 Introduction</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/2.2 Message Layout">2.2 Message Layout</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/2.3 Standard Payloads Layout">2.3 Standard Payloads Layout</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/2.4 Data Flow">2.4 Data flow</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/3.3 Peer Discovery">3.3 Peer Discovery</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/3.4 Neighbor Selection">3.4 Neighbor Selection</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.1 The Tangle">4.1 The Tangle</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.2 Timestamps">4.2 Timestamps</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.3 Tip Selection Algorithm">4.3 Tip Selection Algorithm</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.4 Solidification">4.4 Solidification</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.5 Rate Control">4.5 Rate Control through Adaptive Proof of Work</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.6 Congestion Control">4.6 Congestion control</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.7 Markers">4.7 Markers</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/5.1 UTXO">5.1 UTXO</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/5.2 Ledger State">5.2 Ledger State</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/5.3 Mana">5.3 Mana</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.1 Objects of Consensus">6.1 Objects of Consensus</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/IOTA-2.0-Research-Specifications/6.2 Opinion Setting">6.2 Opinion Setting</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.3 Fast Probabilistic Consensus">6.3 Fast Probabilistic Consensus</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.4 Finalization">6.4 Approval Weight and Finality</a></li><li class="menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.5 dRNG">6.5 Distributed Random Number Generator</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">6.2 Opinion Setting</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="621-preliminaries"></a>6.2.1 Preliminaries<a class="hash-link" href="#621-preliminaries" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="6212-motivation"></a>6.2.1.2 Motivation<a class="hash-link" href="#6212-motivation" title="Direct link to heading">#</a></h3><p>FPC is a binary voting protocol which takes a series of initial boolean values, and outputs a final value: see <a href="/IOTA-2.0-Research-Specifications/6.3 Fast Probabilistic Consensus">Section 6.3 - Fast Probabilistic Consensus</a>.  This specification describes how to set this initial Boolean value. Specification <a href="/IOTA-2.0-Research-Specifications/6.1 Objects of Consensus">6.1 - Object of Consensus</a> describes how FPC interacts with other modules in the protocol, specifically how the functions <code>QueryStatus</code> and <code>AnswerStatus</code> react to the metadata <code>opinionField</code>. Moreover, the FPC specification, <a href="/IOTA-2.0-Research-Specifications/6.3 Fast Probabilistic Consensus">Section 6.3 - Fast Probabilistic Consensus</a>, describes how the <code>opinionField</code> is updated when FPC terminates.</p><p>We need to describe how to set the initial opinion and how to trigger FPC voting. Specifically, we need to describe how the metadata <code>opinionField</code> is initially set.  Since the outcome of FPC respects a supermajority of initial opinions, it is important that the initial opinion is set correctly.  For example, if 90% of nodes (weighted by active consensus mana) initially want to accept a transaction, the transaction is accepted with very high probablity.  </p><p>Recall from specification <a href="/IOTA-2.0-Research-Specifications/6.1 Objects of Consensus">Section 6.1 - Object of Consensus</a>, that <code>opinionField</code> consists of fields, <code>opinion</code> which is a boolean, <code>level</code> which is either 1,2, or 3, and <code>timeFormed</code> which is a time.  In this specification, we describe how these three fields are set for both messages and transactions.  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="6213-summary"></a>6.2.1.3 Summary<a class="hash-link" href="#6213-summary" title="Direct link to heading">#</a></h3><p>In this specification, we describe how the Opinion Setter, see <a href="/IOTA-2.0-Research-Specifications/2.4 Data Flow">Section 2.4 - Data Flow</a>, initially sets <code>opinionField</code> metadata for every object being voted upon. Specifically, the opinion setter writes:</p><ul><li>The initial opinion, i.e. the initial boolean value.</li><li>The level of knowledge which dictates when FPC will be triggered.</li><li>The time the opinion was formed. </li></ul><p>See <a href="/IOTA-2.0-Research-Specifications/6.1 Objects of Consensus">Section 6.1 - Object of Consensus</a> for a detailed explanation of these fields. </p><p>As discussed in <a href="/IOTA-2.0-Research-Specifications/6.1 Objects of Consensus">Section 6.1 - Object of Consensus</a>, FPC can potentially vote on two main object types:</p><ul><li>transactions in order to resolve conflicts</li><li>timestamps in order to judge timestamps</li></ul><p>We split this specification into two main sections: the first dealing with setting the opinion on messages and their timestamps, and the second on setting the opinion on transactions.  </p><p>With regards to timestamps, we vote on whether or not the timestamp is &quot;too old&quot; when the message arrives to the node. As with voting on transactions, we can reset this opinion using the approval weight even if the node is out of sync.  </p><p>We judge transactions based on the FCoB rule, which stands for Fast Consensus of Barcelona, in honor of the research summit where the rule was first defined.  A transaction <code>X</code> satisfied the FCoB rule if the node has not received any transactions conflicting with <code>X</code> before <code>arrivalTime(X)+C</code> where <code>C</code> is the FCoB parameter.  Recall from [Section 6.4 - Finalization](./6.4 Finalization.md) that two transactions conflict if they consume the same UTXO outputs. </p><p>Intuitively, the FCoB rule only accepts a transaction if it has arrived significantly before any other conflict.  The FCoB rule guarantees that if one transaction is liked by a significant number of nodes (weighted by consensus mana), that all other conflicting transactions will be initially disliked by a supermajority of nodes, and thus rejected by FPC, guaranteeing that no two conflicting messages will be approved by FPC. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="6214-dependencies"></a>6.2.1.4 Dependencies<a class="hash-link" href="#6214-dependencies" title="Direct link to heading">#</a></h3><p>This part of the specification depends on the following specifications:</p><ul><li><a href="/IOTA-2.0-Research-Specifications/4.2 Timestamps">Section 4.2 - Timestamps</a></li><li><a href="/IOTA-2.0-Research-Specifications/5.2 Ledger State">Section 5.2 - Ledger State</a></li><li><a href="/IOTA-2.0-Research-Specifications/6.1 Objects of Consensus">Section 6.1 - Object of Consensus</a></li><li><a href="/IOTA-2.0-Research-Specifications/6.4 Finalization">Section 6.4 - Finalization</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="6214-parameters-and-lists"></a>6.2.1.4 Parameters and Lists<a class="hash-link" href="#6214-parameters-and-lists" title="Direct link to heading">#</a></h3><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>DLARGE</code></td><td>duration</td><td>Gratuitous network delay estimate; set to 15 seconds</td></tr><tr><td><code>W</code></td><td>duration</td><td>Time window, set to 1 minute. Require W&gt;2DLARGE</td></tr><tr><td><code>DSMALL</code></td><td>duration</td><td>Small estimated network delay, set to 5 seconds</td></tr><tr><td><code>C</code></td><td>duration</td><td>FCoB parameter=DSMALL</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="622-timestamps"></a>6.2.2 Timestamps<a class="hash-link" href="#622-timestamps" title="Direct link to heading">#</a></h2><p>The timestamp defines the time when the message was created. Voting on timestamps ensures that nodes are issuing messages with correct timestamps, where correct means that the offset with current time is lower than a certain parameter <code>W</code>.  This time window is large to account for the network delay. In order to have consensus on the accuracy of the timestamp, and hence the eligibility of the message, we use <a href="/IOTA-2.0-Research-Specifications/6.3 Fast Probabilistic Consensus">FPC</a> voting, along with the levels of knowledge.  </p><p>Clearly, in order to have a correct perception of the timestamp quality, <strong>we assume the node is in sync</strong> (see section <a href="#Not-in-Sync">Not in Sync</a> otherwise).
Voting on timestamps should not occur for every message. Specifically, only for those that arrive with an offset close to <code>W</code>, i.e. within <code>DLARGE</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="6221-setting-the-initial-opinion"></a>6.2.2.1 Setting the initial opinion<a class="hash-link" href="#6221-setting-the-initial-opinion" title="Direct link to heading">#</a></h3><p>In this section, we describe how the <code>opinionField</code> is set for messages, and how we achieve consensus on the correctness of timestamps. </p><p>The opinion of timestamp is stored according to the rules laid out in the [Object of Consensus](./6.1 Objects of Consensus.md) specification.  The opinion is set by the module called the <code>OpinionManager</code>: see <a href="/IOTA-2.0-Research-Specifications/2.4 Data flow">Section 2.4 - Data Flow</a>.  Refer to the <a href="/IOTA-2.0-Research-Specifications/6.3 Fast Probabilistic Consensus">FPC</a> specification to see how the voting actually takes place.  </p><p>The node shall set <code>messageID.opinionField=timestampOpinion(messageID)</code>, using the function defined below.</p><p>The initial opinion and level of knowledge are set according to the following rule:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly vbnet"><pre tabindex="0" class="prism-code language-vbnet codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">FUNCTION (bool,level,time) = timestampOpinion(messageID)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">time = CurrentTime()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IF messageID.arrivalTime+w &gt;= CurrentTime()  </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    opinion = TRUE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ELSE </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    opinion = DISLIKE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IF |messageID.arrivalTime +W - CurrentTime() | &gt;= DLARGE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    level = 2</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ELSE IF |messageID.arrivalTime +W - CurrentTime() | &gt;= 2*DLARGE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    level = 3</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ELSE </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    level = 1</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Recall that the <code>arrivalTime.messageID</code> is the time that the message was received by the node: see <a href="/IOTA-2.0-Research-Specifications/2.2 Message Layout">Section 2.2 - Message Layout</a>.
The initial opinion is set based on the question &quot;did the transaction arrive before <code>currentTime - W</code>?&quot;.  The level of knowledge is then set by the margin as a factor of the delay time.  Specifically, under the assumption that all messages are delivered to all nodes within time <code>DLARGE</code> after the arrive (with high probability), then: </p><ul><li>If <code>|arrivalTime +W - currentTime | &lt; DLARGE</code>, then the node can make any conclusions about the arrival times of the message, and hence it has only level of knowledge 1.</li><li>If one node has <code>|arrivalTime +W - currentTime | &gt;= DLARGE </code>, then all nodes must have the same opinion, and hence that node has level of knowledge at least 2.</li><li>If one node has <code>|arrivalTime +W - currentTime | &gt;= 2*DLARGE</code>, then all nodes must have <code>|arrivalTime +W - currentTime | =&gt; DLARGE</code> guaranteeing level of knowledge 3.
<img src="https://i.imgur.com/a5or78c.png"></li></ul><p>For example, let us set <code>w</code> and <code>D</code> to 1 minute and 15 seconds respectively. Let&#x27;s assume that the current time is 12:00:00 and we have to evaluate a new message with timestamp set at 11:59:45. Since 11:59:45 +1 minute&gt;12:00:00, the node will set the opinion to <code>LIKE</code>. Moreover, since |11:59:45+1 minute-12:00:00| is greater than 15 seconds, and also grater than 2*15 seconds, the node will set the level of knowledge for this opinion to 3 (i.e., the supermajority of the network should already have the same opinion).</p><p>Consider now a new message with timestamp 11:59:10. Since 11:59:10+1 minute&gt;12:00:00, the node will set the opinion to <code>TRUE</code>. However, since |11:59:10+1 minute-12:00:00| is lower than 15 seconds, the node will set the level of knowledge for to 1, meaning that this message  will be voted upon by FPC. </p><p>In general, timestamps with level of knowledge 1 will be input into FPC, that will eventually trigger the <code>finalized</code> event, after which we may set a message as eligible or as discarded, depending on the outcome. If instead, the timestamp the node is considering has already level of knowledge larger or equal than 2, the node does not need to vote, but has to reply to queries. Either it is eligible (marked as liked) or it is marked as disliked. If the timestamp has level of knowledge 3, the node does not reply to FPC queries.</p><p>With high probability, we can be sure that for any time <code>t</code>, no node can issue a message with timestamp <code>t</code> after <code>t + W + 2*DLARGE</code>, because after this time, the message would be considered to be bad with level of knowledge 3.  Thus, assuming the node is in sync, see [Section 6.5 - Node Perception Reorganization](./6.5 Node Perception Reorganization.md), after approximately 1.5 minutes, the number of messages of a particular timestamp cannot be altered. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="623-transactions-and-fcob"></a>6.2.3 Transactions and FCoB<a class="hash-link" href="#623-transactions-and-fcob" title="Direct link to heading">#</a></h2><p>In this section, we discuss how to set the <code>opinionField</code> on transactions through the so-called FCoB rule.  Recall that a transaction <code>X</code> satisfies the FCoB rule if the node has not received any transactions conflicting with <code>X</code> before <code>arrivalTime(X)+C</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="6231-fcob-function"></a>6.2.3.1 FCoB function<a class="hash-link" href="#6231-fcob-function" title="Direct link to heading">#</a></h3><p>We now define the function <code>FCOB</code> which decides the opinion of the transaction.  When setting the opinion, the node simply sets <code>opinionField=FCOB(transactionID)</code>.  </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly vbnet"><pre tabindex="0" class="prism-code language-vbnet codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">FUNCTION (bool,level,time) = FCOB(transactionID)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">time = currentTime</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IF transactionID IS NOT a conflict</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bool = TRUE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    IF currentTime &lt;= transactionID.arrivalTime + C + DSMALL</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        level = 1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ELSE IF currentTime &lt;= transactionID.arrivalTime + C + 2 * DSMALL</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        level = 2</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ELSE </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        level = 3</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ELSE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    FOR x IN conflict with transactionID</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        IF x.arrivalTime &gt;= transactionID.arrivalTime + C OR ( x.opinionField.opinion == FALSE AND x.opinionField.level == 2 OR 3)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        bool = TRUE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        level = 1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ELSE </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    conflictTime= MIN(x.arrivalTime FORALL x conflicting with transactionID)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    IF transaction.arrivalTime + C &lt;= conflictTime </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        bool = TRUE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ELSE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        bool = FALSE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    If |transaction.arrivalTime + C - conflictTime| &lt;= DSMALL</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        level = 1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ELSE IF |transaction.arrivalTime + C - conflictTime| &lt;= 2DSMALL</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        level = 2</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ELSE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        level = 3</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RETURN (bool,level,timeFormed)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We now will explain the logical behind this function.  There are three cases which are treated:</p><ol><li>No conflicts have been detected</li><li>Conflicts have been detected but have been rejected</li><li>Conflicts have been detected are either pending or have been confirmed</li></ol><p>Case 3 is the simplest case: since conflicts have been detected, we set the opinion according to the FCOB rule.  Then level is set according to the difference of <code>transaction.arrivalTime + C</code> and  <code>conflictTime</code>, the oldest arrival time of a conflicting transaction.  Essentially, the level measures how many network delays there are between these two values.   </p><p>In Case 1 is the most common because conflicts will never arrive for most transactions. Without conflicts, the opinion can be only set provisionally since it might change if a conflict arrives later. The opinion is set to true, but the level is set as if a conflict arrived at that time.   For example, after  <code>C + DSMALL</code> time has elapsed since arrival time, if a conflict does arrive the opinion will remain true with level at least 2.  </p><p>Lastly, Case 2 is an important special case of the FCoB rule. To see the need for this modification consider the following example.  Suppose someone issues a pair of conflicting transactions where both transactions are rejected by FPC.  Then, if someone ever issues a new transaction consuming those funds, FCoB, strictly speaking would reject the new transaction, since it would conflict with a previous transaction.  Thus, if a pair of double spends are rejected, the funds would be locked.  This is undesirable and impractical behavior: an honest but malfunctioning wallet can issue double spends.  Moreover, tracking the locked funds would be onerous. </p><p>To prevent the FCoB rule from locking funds, we modify it to the following: a transaction <code>X</code> satisfied the FCoB rule if all transactions <code>Y</code> conflicting with <code>X</code>  before <code>arrivalTime(X)+C</code> has been rejected, i.e. has has opinion false and level 2 or 3.  With this rule, any conflicts which are rejected will not affect the opinion on future conflicts.  For simplicity case, all transactions falling under this case are treated as level 1.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="6232-when-to-set-the-opinion"></a>6.2.3.2 When to set the opinion<a class="hash-link" href="#6232-when-to-set-the-opinion" title="Direct link to heading">#</a></h3><p>The protocol is actually flexible on when the opinion field of a transaction is set.  However, the node must do the following. </p><ul><li>The opinion of a transaction must be set after it is booked.  When the transaction is booked, the node searches for conflicts, and if a conflict exists the node either creates a new conflict set or else it adds the transaction to an old conflict sets.  If the <code>FCoB</code> function is called before the transaction is booked, it will be impossible to tell what conflicts exist.</li><li>The opinion field is <code>NULL</code> only if no conflicts have been detected</li><li>Fore very valid <code>transactionID</code>, the <code>transactionID.opinionField</code> is either NULL or &quot;correct&quot; at the  times <code>transactionID.arrivalTime + C + DSMALL</code> and <code>transactionID.arrivalTime + C + 2DSMALL</code>, i.e. the opinion field would be unchanged if reset at that those two times. </li></ul><p>There are a plethora of ways this could be implemented. We give two examples.  </p><p>First, after a message is booked, its transaction, say <code>transactionID</code> is added to a timed queue.  At <code>transactionID.arrivalTime + C + DSMall</code> the opinion is set, and then either the transaction is rejected (i.e. bad with level 2 or 3), voted upon (level 1), or goes to tip selection (good level 2). If no conflict has been detected, the transaction (i.e. the transaction is good level 2), the transaction is put in another timed queue.  At time <code>transactionID.arrivalTime + C + 2DSMall</code> the opinion is reset.  Note, once a conflict is detected the opinion field would not change, and so only transactions which are not part of conflict sets need to enter the second timed queue.</p><p>Second, while a transaction is being booked, conflict detection can immediately trigger setting the opinion field for all the new conflicts. This would include the transaction itself and any members of its conflict set which previously had a <code>NULL</code> opinion field. This implementation has a few caveats:</p><ul><li>Any transaction with a <code>NULL</code> opinion field must be treated as a &quot;good&quot; transaction.  At any time, the appropriate level of knowledge could be computed by looking at the arrival time.</li><li>Before the monotonically liked flag is set, the transaction must be at least <code>transactionID.arrivalTime + C + DSMall</code> and have either opinion field <code>NULL</code> or (good, level 2 or 3). </li></ul><p>Although this is an implementation detail, we remark that after a transaction is booked, it is easy to see if a message is a conflict or not. Indeed, when a conflict is detected, a new branch is created, and the ID of that new branch is the same as the <code>transactionID</code>. Thus a transaction is a conflict if and only if <code>transactionID = transactionID.branchID</code>.  See <a href="/IOTA-2.0-Research-Specifications/5.2 Ledger State">Section 5.2 - Ledger State</a>.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/IOTA-2.0-Research-Specifications/6.1 Objects of Consensus"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 6.1 Objects of Consensus</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/IOTA-2.0-Research-Specifications/6.3 Fast Probabilistic Consensus"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">6.3 Fast Probabilistic Consensus »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#621-preliminaries" class="table-of-contents__link">6.2.1 Preliminaries</a><ul><li><a href="#6212-motivation" class="table-of-contents__link">6.2.1.2 Motivation</a></li><li><a href="#6213-summary" class="table-of-contents__link">6.2.1.3 Summary</a></li><li><a href="#6214-dependencies" class="table-of-contents__link">6.2.1.4 Dependencies</a></li><li><a href="#6214-parameters-and-lists" class="table-of-contents__link">6.2.1.4 Parameters and Lists</a></li></ul></li><li><a href="#622-timestamps" class="table-of-contents__link">6.2.2 Timestamps</a><ul><li><a href="#6221-setting-the-initial-opinion" class="table-of-contents__link">6.2.2.1 Setting the initial opinion</a></li></ul></li><li><a href="#623-transactions-and-fcob" class="table-of-contents__link">6.2.3 Transactions and FCoB</a><ul><li><a href="#6231-fcob-function" class="table-of-contents__link">6.2.3.1 FCoB function</a></li><li><a href="#6232-when-to-set-the-opinion" class="table-of-contents__link">6.2.3.2 When to set the opinion</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer padding--none padding-top--xl"><div class="row footer__links padding-top--lg padding-bottom--xl"><div class="col footer__col"><h4 class="footer__title">LEARN</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/learn/about-iota/an-introduction-to-iota">About IOTA</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/iota-token/overview">IOTA Token</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/wallets/what-is-a-wallet">Wallets</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/networks/iota-1.5-chrysalis">Networks</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/resource-materials/glossary">Resource Materials</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/research/research-outline">Research</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">USE</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/use/use-cases/industry-applications">Use Cases</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/use/streams/encrypted-data-comms">Streams</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/use/identity/enabling-privacy-and-trust">Identity</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/use/access/secure-access-control">Access</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/use/smart-contracts/programmable-contracts">Smart Contracts</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/use/stronghold/protecting-your-secrets">Stronghold</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/use/oracles/trust-in-real-world-data">Oracles</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/use/utilities/tangle-explorer">Utilities</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">DEVELOP</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/develop/getting-started/architecture">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/develop/fundamentals/cryptography">Fundamentals</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/develop/exchange-integration/guide">Exchange Integration</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/develop/tutorials/youtube">Tutorials</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">PARTICIPATE</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/participate/support-the-network/run-a-node">Support the network</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/the-community/discord">The Community</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/partnerships/iota-partnerships">Partnerships</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/funding/edf-funding">Funding</a></li></ul></div></div><div class="footer__bottom padding-top--xl padding-bottom--lg"><div><a href="https://www.iota.org" target="_blank" rel="noopener noreferrer"><img src="/img/iota_logo.svg" alt="IOTA Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/iota_logo_dark.svg" alt="IOTA Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">© 2021 IOTA Wiki, Built with Docusaurus.</div></div><div class="socialBar_2nY3"><a class="padding-horiz--sm padding-vert--md socialLink_1As6" style="background-color:#18243C" href="https://www.youtube.com/c/iotafoundation"><img class="socialImage_2plZ" src="/img/youtube.svg"><div class="socialTitle_3JEm">Youtube</div></a><a class="padding-horiz--sm padding-vert--md socialLink_1As6" style="background-color:#24314A" href="https://www.github.com/iotaledger/"><img class="socialImage_2plZ" src="/img/github.svg"><div class="socialTitle_3JEm">GitHub</div></a><a class="padding-horiz--sm padding-vert--md socialLink_1As6" style="background-color:#303C56" href="https://discord.iota.org/"><img class="socialImage_2plZ" src="/img/discord.svg"><div class="socialTitle_3JEm">Discord</div></a><a class="padding-horiz--sm padding-vert--md socialLink_1As6" style="background-color:#3B4862" href="https://www.twitter.com/iota/"><img class="socialImage_2plZ" src="/img/twitter.svg"><div class="socialTitle_3JEm">Twitter</div></a><a class="padding-horiz--sm padding-vert--md socialLink_1As6" style="background-color:#47546F" href="https://www.reddit.com/r/iota/"><img class="socialImage_2plZ" src="/img/reddit.svg"><div class="socialTitle_3JEm">Reddit</div></a><a class="padding-horiz--sm padding-vert--md socialLink_1As6" style="background-color:#52607B" href="https://www.linkedin.com/company/iotafoundation/"><img class="socialImage_2plZ" src="/img/linkedin.svg"><div class="socialTitle_3JEm">Linkedin</div></a><a class="padding-horiz--sm padding-vert--md socialLink_1As6" style="background-color:#5E6B87" href="https://www.instagram.com/iotafoundation/"><img class="socialImage_2plZ" src="/img/instagram.svg"><div class="socialTitle_3JEm">Instagram</div></a></div></footer></div>
<script src="/assets/js/runtime~main.25fc0cbb.js"></script>
<script src="/assets/js/main.d75ef5b9.js"></script>
</body>
</html>